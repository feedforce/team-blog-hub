<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon shortcut" type="image/png" href="https://feedforce.github.io/team-blog-hub/logo.png"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap"/><title>masutaka | Feedforce Engineers&#x27; Blogs</title><meta property="og:title" content="masutaka"/><meta property="og:url" content="https://feedforce.github.io/team-blog-hub/members/masutaka"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:site" content="Feedforce Engineers&#x27; Blogs"/><meta property="og:image" content="https://feedforce.github.io/team-blog-hub/og.png"/><link rel="canonical" href="https://feedforce.github.io/team-blog-hub/members/masutaka"/><link rel="preload" href="/team-blog-hub/_next/static/css/d7faf1fdf25fe7d3262e.css" as="style"/><link rel="stylesheet" href="/team-blog-hub/_next/static/css/d7faf1fdf25fe7d3262e.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/team-blog-hub/_next/static/chunks/main-8a83f0fd99327c4684a8.js" as="script"/><link rel="preload" href="/team-blog-hub/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/team-blog-hub/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" as="script"/><link rel="preload" href="/team-blog-hub/_next/static/chunks/commons.82441a6bfdc77aa8dc79.js" as="script"/><link rel="preload" href="/team-blog-hub/_next/static/chunks/pages/_app-db173d743a8bd3a15b64.js" as="script"/><link rel="preload" href="/team-blog-hub/_next/static/chunks/588505f8033a39c9ef82bc46b1145ac9fd1db500.28d75d70b20e6708c167.js" as="script"/><link rel="preload" href="/team-blog-hub/_next/static/chunks/pages/members/%5Bname%5D-86638f6fce8375479415.js" as="script"/></head><body><div id="__next"><header class="site-header"><div class="content-wrapper"><div class="site-header__inner"><a class="site-header__logo-link" href="/team-blog-hub"><img src="https://feedforce.github.io/team-blog-hub/logo.svg" alt="Feedforce Engineers&#x27; Blogs" class="site-header__logo-img"/></a><div class="site-header__links"><a href="https://www.feedforce.jp" class="site-header__link">Company</a><a href="https://github.com/feedforce" class="site-header__link">GitHub</a><a href="https://engineers.recruit.feedforce.jp" class="site-header__link">Recruit</a></div></div></div></header><section class="member"><div class="content-wrapper"><header class="member-header"><div class="member-header__avatar"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" alt="masutaka" width="100" height="100" class="member-header__avatar-img"/></div><h1 class="member-header__name">masutaka</h1><p class="member-header__bio">カレー大好き！</p><div class="member-header__links"><a href="https://twitter.com/masutaka" class="member-header__link"><img src="https://feedforce.github.io/team-blog-hub/icons/twitter.svg" alt="Twitterのユーザー@masutaka" width="22" height="22"/></a><a href="https://github.com/masutaka" class="member-header__link"><img src="https://feedforce.github.io/team-blog-hub/icons/github.svg" alt="GitHubのユーザー@masutaka" width="22" height="22"/></a><a href="https://masutaka.net" class="member-header__link"><img src="https://feedforce.github.io/team-blog-hub/icons/link.svg" alt="ウェブサイトのリンク" width="22" height="22"/></a></div></header><div class="member-posts-container"><div class="post-list"><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-08-30T06:00:00.000Z" class="post-link__date">a day ago</time></div></a><a href="https://developer.feedforce.jp/entry/2021/08/30/150000" class="post-link__main-link"><h2 class="post-link__title">Looker で Join 先の view の primary_key をいい感じにテストする方法をようやく見つけた</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a><div class="post-link__new-label">NEW</div></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-08-25T14:59:59.000Z" class="post-link__date">6 days ago</time></div></a><a href="https://masutaka.net/chalow/2021-08-25-1.html" class="post-link__main-link"><h2 class="post-link__title">Manjaro でハイバネート出来るようにしたメモ</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=masutaka.net" width="14" height="14" class="post-link__site-favicon"/>masutaka.net</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-08-16T06:00:00.000Z" class="post-link__date">15 days ago</time></div></a><a href="https://developer.feedforce.jp/entry/2021/08/16/150000" class="post-link__main-link"><h2 class="post-link__title">私が１年かけて辿り着いた Looker の情報収集方法を紹介する</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-08-07T14:59:59.000Z" class="post-link__date">24 days ago</time></div></a><a href="https://masutaka.net/chalow/2021-08-07-1.html" class="post-link__main-link"><h2 class="post-link__title">Chrome から Firefox に乗り換えたよ</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=masutaka.net" width="14" height="14" class="post-link__site-favicon"/>masutaka.net</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-07-28T14:59:59.000Z" class="post-link__date">a month ago</time></div></a><a href="https://masutaka.net/chalow/2021-07-28-1.html" class="post-link__main-link"><h2 class="post-link__title">３月に無償提供となった Microsoft Power Automate Desktop を今さらながら使ってみた</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=masutaka.net" width="14" height="14" class="post-link__site-favicon"/>masutaka.net</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-06-11T09:00:00.000Z" class="post-link__date">3 months ago</time></div></a><a href="https://developer.feedforce.jp/entry/2021/06/11/180000" class="post-link__main-link"><h2 class="post-link__title">『ここがつらいよ普段使いのLinux』という発表をした</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-06-10T14:59:59.000Z" class="post-link__date">3 months ago</time></div></a><a href="https://masutaka.net/chalow/2021-06-10-1.html" class="post-link__main-link"><h2 class="post-link__title">Dependabot の Terraform 1.0 対応が完了した件</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=masutaka.net" width="14" height="14" class="post-link__site-favicon"/>masutaka.net</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-05-30T14:59:59.000Z" class="post-link__date">3 months ago</time></div></a><a href="https://masutaka.net/chalow/2021-05-30-1.html" class="post-link__main-link"><h2 class="post-link__title">暑がりの私にはマスクチェーンがとても合ってる</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=masutaka.net" width="14" height="14" class="post-link__site-favicon"/>masutaka.net</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-05-27T14:59:59.000Z" class="post-link__date">3 months ago</time></div></a><a href="https://masutaka.net/chalow/2021-05-27-1.html" class="post-link__main-link"><h2 class="post-link__title">Dependabot の Terraform 0.15 対応が進んでいる件</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=masutaka.net" width="14" height="14" class="post-link__site-favicon"/>masutaka.net</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-05-23T14:59:59.000Z" class="post-link__date">3 months ago</time></div></a><a href="https://masutaka.net/chalow/2021-05-23-1.html" class="post-link__main-link"><h2 class="post-link__title">ノートパソコンクーラーを買い替えた</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=masutaka.net" width="14" height="14" class="post-link__site-favicon"/>masutaka.net</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-02-15T02:00:00.000Z" class="post-link__date">6 months ago</time></div></a><a href="https://developer.feedforce.jp/entry/2021/02/15/110000" class="post-link__main-link"><h2 class="post-link__title">全ての esa 新着記事を読みきれないので、最近はこの方法を使ってる</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2021-02-03T02:00:00.000Z" class="post-link__date">7 months ago</time></div></a><a href="https://developer.feedforce.jp/entry/2021/02/03/110000" class="post-link__main-link"><h2 class="post-link__title">変化に耐え得る esa のカテゴリ設計を徹底的に考えてみた</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2020-10-23T10:00:00.000Z" class="post-link__date">10 months ago</time></div></a><a href="https://developer.feedforce.jp/entry/2020/10/23/190000" class="post-link__main-link"><h2 class="post-link__title">『4月から取り組んできたLookerの導入から実装までのお話（Redashとも比較）』という発表をした</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2020-06-29T05:00:00.000Z" class="post-link__date">a year ago</time></div></a><a href="https://developer.feedforce.jp/entry/2020/06/29/140000" class="post-link__main-link"><h2 class="post-link__title">個人的に実践している、Slack に振り回されない方法</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2020-03-02T05:00:00.000Z" class="post-link__date">a year ago</time></div></a><a href="https://developer.feedforce.jp/entry/2020/03/02/140000" class="post-link__main-link"><h2 class="post-link__title">『HerokuでSidekiqを監視する方法を確立した』という発表をした</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2020-02-13T06:00:00.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2020/02/13/150000" class="post-link__main-link"><h2 class="post-link__title">Heroku Ruby Language Metrics のメトリクス収集の仕組みを調べた</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2019-12-14T06:30:00.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2019/12/14/153000" class="post-link__main-link"><h2 class="post-link__title">Heroku Meetup #27 で『デプロイで止まらないバッチ処理を求めて』という話をしてきた #herokujp</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2019-12-05T01:19:31.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2019/12/05/101931" class="post-link__main-link"><h2 class="post-link__title">月末に起動したいバッチを sidekiq-cron で指定し、healthchecks.io で監視する</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2019-07-29T05:00:00.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2019/07/29/140000" class="post-link__main-link"><h2 class="post-link__title">Heroku Meetup #25 &quot;Heroku Ghost&quot; で 2 回話してきた #herokujp</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2019-07-01T05:00:00.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2019/07/01/140000" class="post-link__main-link"><h2 class="post-link__title">esa をネタに Emacs Lisp と Elm を無理やり繋げた発表をした</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2019-04-26T06:45:40.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2019/04/26/154540" class="post-link__main-link"><h2 class="post-link__title">Heroku で Chrome を使ったクローラの IP アドレスを固定する</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2018-12-12T03:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2018/12/12/120000" class="post-link__main-link"><h2 class="post-link__title">Heroku の Preboot 機能を深掘りした</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2018-11-14T05:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2018/11/14/140000" class="post-link__main-link"><h2 class="post-link__title">『Heroku と EC Booster と私』と『Heroku ちょこっと Deep Dive』という発表をした</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2018-10-09T05:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2018/10/09/140000" class="post-link__main-link"><h2 class="post-link__title">terraform-provider-healthchecksio に足りない機能を実装したらコラボレータになれた</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2018-06-15T04:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2018/06/15/130000" class="post-link__main-link"><h2 class="post-link__title">先期の MVP に選ばれた</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2018-05-21T06:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2018/05/21/150000" class="post-link__main-link"><h2 class="post-link__title">『開発基盤チームとして課題を探したらマネジメントをしていた』という発表をした</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/team-blog-hub/members/masutaka"><img src="https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">masutaka</div><time dateTime="2017-10-16T06:00:00.000Z" class="post-link__date">4 years ago</time></div></a><a href="https://developer.feedforce.jp/entry/2017/10/16/150000" class="post-link__main-link"><h2 class="post-link__title">github-nippou という gem を golang で書き直したという発表をした</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=developer.feedforce.jp" width="14" height="14" class="post-link__site-favicon"/>developer.feedforce.jp</div></a></article></div></div></div></section><footer class="site-footer"><div class="content-wrapper"><p>© <!-- -->Feedforce Inc.</p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"member":{"name":"masutaka","role":"LookML Developer","bio":"カレー大好き！","avatarSrc":"https://www.gravatar.com/avatar/b7a93b5c3bcfa8f2f8047584cc16bf13?size=256","sources":["https://developer.feedforce.jp/feed/author/masutaka26","https://masutaka.net/chalow/cl.rss"],"includeUrlRegex":"developer.feedforce.jp|masutaka.net","twitterUsername":"masutaka","githubUsername":"masutaka","websiteUrl":"https://masutaka.net"},"postItems":[{"title":"Looker で Join 先の view の primary_key をいい感じにテストする方法をようやく見つけた","contentSnippet":"こんにちは、id:masutaka26 です。先週はまるっと夏休みにしてました。今日からまた Looker と戯れる日々が始まります。丸１年 Looker と戯れてきて最近ようやく、Join 先の view でも primary_key が壊れてないことを保証するテストの書き方が分かったので、今回紹介します。Looker における primary_key の役割primary_key の実装例LookML 開発におけるテストJoin 先の view は primary_key をテスト出来ないことがあるJoin 先の view の primary_key をいい感じにテストするまとめと所感おまけLooker における primary_key の役割Looker には Symmetric Aggregates という、合計を重複させない素晴らしい仕組みがあります。以前このブログでも紹介しました。その Symmetric Aggregates では primary_key が重要な役割を果たします。適切に設定されていないと、以下のような問題が発生します。primary_key が重複すると fanout エラーが発生することがあるprimary_key が null だと Measure が 0 になることがあるこのような問題は大概、ふわっと質問が来て発覚します。今のタスクを保留にして調査することは精神的になかなか辛いものがあり、それなりに時間も費やすことになるため、可能な限り事前に避けたいところです。primary_key の実装例私が所属する Feedmatic では、ウェブ広告や Google Analytics のデータを扱っています。正規化されたきれいなデータは少なく、Rails の id のようなユニークなカラムは存在しないことが多いです。そのため、このようにいくつかの Dimension を組み合わせて primary_key を定義します。dimension: id {  primary_key: yes  type: string  sql: CONCAT(${dimension1}, ${dimension2}, IFNULL(${dimension3}, '')) ;;  hidden: yes}※ DWH は BigQuery を使っています。これで済めばよいのですが、上の例だとある日突然 dimension2 が null になり始めたり、全ての string 型の Dimension を使っても重複し始めることがあります。データの性格は理解していたつもりでしたが、実際どちらもありました。😭LookML 開発におけるテスト以上の課題を解決するために、test パラメータが使えます。例えばこのような parent explore があったとします。Join がないのでシンプルです。explore: parent {  ...}view: parent {  dimension: id {    primary_key: yes    ...  }  measure: count {    type: count  }}私はこのようなテストを書いて、全ての parent.id が null でないことと、重複しないことを保証させています。test: parent_id_is_not_null {  explore_source: parent {    column: id {}    sorts: [parent.id: asc]    limit: 1  }  assert: id_is_not_null {    expression: NOT is_null(${parent.id}) ;;  }}test: parent_id_is_unique {  explore_source: parent {    column: id {}    column: count {}    sorts: [parent.count: desc]    limit: 1  }  assert: id_is_unique {    expression: ${parent.count} = 1 ;;  }}👉 ソート時に null が先頭と末尾のどちらに来るかは、DWH の実装によります。Join 先の view は primary_key をテスト出来ないことがあるさて、child view を Join する必要が出てきました。explore: parent {  join: child {    type: left_outer    relationship: one_to_many    sql_on: ... ;;  }}view: parent {  dimension: id {    primary_key: yes    ...  }  measure: count {    type: count  }}view: child {  dimension: id {    primary_key: yes    ...  }  measure: count {    type: count    hidden: yes  }}同じように child.id のテストを書きましたが、うまくいきません。is_not_null はまだしも、is_unique がダメです。# これは OKtest: parent_child_id_is_not_null {  explore_source: parent {    column: id { field: child.id }    sorts: [child.id: asc]    limit: 1  }  assert: child_id_is_not_null {    expression: NOT is_null(${child.id}) ;;  }}# parent の count になり、テストが通らない。test: parent_child_id_is_unique {  explore_source: parent {    column: id { field: child.id }    column: count { field: child.count }    sorts: [parent.count: desc]    limit: 1  }  assert: child_id_is_unique {    expression: ${child.count} = 1 ;;  }}よく考えれば当たり前の話で、Join した状態でテストを書いているからです。そもそも child view の primary_key のテストをしたいだけなのに、Join は邪魔です。Join 先の view の primary_key をいい感じにテストするchild view と同じファイルに、こっそり child explore を定義します。hidden にして存在を消しています。さらに required_access_grants で、開発者以外の URL 直打ちによるアクセスも防いでいます。view: child {  dimension: id {    primary_key: yes    ...  }  measure: count {    type: count    hidden: yes  }}# Define for testexplore: child {  hidden: yes  required_access_grants: [can_view_explores_for_tests]}access_grant である can_view_explores_for_tests はこのような定義です。# For testsaccess_grant: can_view_explores_for_tests {  user_attribute: view_explores_for_tests  allowed_values: [\"yes\"]}User attribute である view_explores_for_tests は、今回のような「Join 先の view をテストすること」全般に使います。User Access は None、Default Value も no です。開発者用の Group を作り、その Group value を yes にしました。ここまでやらずとも全員アクセス不可でも良いのですが、テストが落ちた時に「クエリの探索」からの調査ができなくなるので、開発者にはアクセス権を与えるポリシーにしています。あとは parent explore と同じようにテストを書くだけです。test: child_id_is_not_null {  explore_source: child {    column: id {}    sorts: [child.id: asc]    limit: 1  }  assert: id_is_not_null {    expression: NOT is_null(${child.id}) ;;  }}test: child_id_is_unique {  explore_source: child {    column: id {}    column: count {}    sorts: [child.count: desc]    limit: 1  }  assert: id_is_unique {    expression: ${child.count} = 1 ;;  }}テストは通っても、LookML validation error が発生するかもしれません。その時は fields パラメータを使って、露出する field を限定すると良いでしょう。# Define for testexplore: child {  hidden: yes  required_access_grants: [can_view_explores_for_tests]  fields: [child.id, child.count] # Avoid LookML validation error}このテクニックは Error: Unknown or Inaccessible Field – Looker Help Center でも紹介されています。まとめと所感LookML 開発者で、且つテストを書いていて、且つ Join 先の view の primary_key に課題を抱えている、大変ニッチな層向けに記事を書きました。どこかの誰かに参考になれば幸いです。もっと良い方法や、今回のやり方はここがマズイとかあれば @masutaka にお知らせ頂けると大変うれしいです。🙏Feedmatic では今回のような view は数十もあり、primary_key のテストはまだ書き始めたばかりです。Looker ではテストは直列でしか実行されないようで、書けば書くほど全テストが遅くなるのはモヤモヤしています。さすがに要望しようと思ってますが。それに関連して、最近ディレクトリやファイル構成を再検討しました。次回はその記事を書く予定です。おまけ今回の記事を書く過程で、中の人が書いたベストプラクティスを見つけました。今回の記事ほど細かいテクニックは書かれていませんが、全体を網羅した良記事なので要チェックです。","link":"https://developer.feedforce.jp/entry/2021/08/30/150000","isoDate":"2021-08-30T06:00:00.000Z","dateMiliSeconds":1630303200000,"authorName":"masutaka"},{"title":"Manjaro でハイバネート出来るようにしたメモ","contentSnippet":"４月から個人 PC を MacBook Air から Linux マシンに変えました。[2021-05-06-1]スライド P41 に書いたとおり、たまにスリープから復帰しなくてつらいです。仕方がないので「スリープしない設定にする。常にAC電源ON🤗」という運用でカバー（）をしていました。😭いつまでも続けるわけにもいかないので、今回重い腰を上げてハイバネート出来るようにしました。Linux (Xfce4) のスリープ方式私が使っているウィンドウマネージャーは Xfce4 です。電源管理の設定等で出てくるスリープ関連の用語と、自分なりの理解は以下のとおりです。情報源は Wikipedia です。😆・サスペンドメモリ以外の給電停止した状態。ACPI では S3 に相当する。・ハイバネートメモリの内容をストレージに移し電源断。ACPI では S4 に相当する。・ハイブリッドスリープサスペンドとハイバネートの中間だと思われるが、試したらすぐハイバネートしただけだった...。macOS (Big Sur) のスリープ方式macOS ではサスペンドやハイバネートの使い分けは不要で、意識するのは「スリープ」のみです。以下のような「セーフスリープ」という機構を備えているそうです。・スリープ状態になると、メモリの内容を保持したままストレージにも保存する・スリープ中にバッテリーが切れていなければ、復帰時にメモリの内容を使う・スリープ中にバッテリーが切れていたら、復帰時にストレージの内容を使う奨励はされていませんが、pmset コマンドでスリープ方式を「セーフスリープ」から「スリープ」または「ディープスリープ」に変更は出来るようです。「スリープ」は ACPI の S3 に相当し、「ディープスリープ」は S4 に相当するようなので、Xfce4 の「ハイブリッドスリープ」は「セーフスリープ」が本来の振る舞いなのかも。※ 状態としての「スリープ」と、その種類としての「スリープ」（と「セーフスリープ」「ディープスリープ」）があるので、文章がややこしいです。Linux と macOS の振る舞いの違いmacOS の素晴らしい点に、ユーザーにスリープをほぼ意識させない設計があると思います。サスペンドやハイバネートのような用語が現れないこともさることながら、MacBook なら蓋を開けばログイン画面が表示されるだけです。多少復帰がもたつくことはあるのはご愛嬌。Linux はサスペンドは同じとしても、ハイバネートは OS の起動から始まるので、「あれ？バッテリー切れてた？」と一瞬不安になります。Windows も同じという理解です。どの OS もバックグラウンドの処理は同じだと思います。macOS はユーザーへの見せ方がきれいですね。Manjaro でのハイバネート設定方法「サスペンドとハイバネート - ArchWiki」に従いました。以下の流れです。1. スワップファイルを作る2. 関連するカーネルパラメータを GRUB（ブートローダー）に追加する3. 関連するフックを initramfs に追加する1. スワップファイルを作る今回は /swapfile という 18GB のスワップファイルを作りました。$ sudo fallocate -l 18G /swapfile$ sudo chmod 600 /swapfile$ sudo mkswap /swapfile$ sudo swapon /swapfileこの VivoBook のメモリは 16GB です。RedHat の記事に従い、スワップファイルのサイズは 18GB にしました。無事作られました。$ swapon -showFilename Type Size Used Priority/swapfile file 18874364 0 -2永続化するために /etc/fstab に以下を追記しました。/swapfile none swap defaults 0 0ちなみに、今回のような任意サイズのファイルは dd でも作れます。ただ、dd は実際にファイル書き込みが発生するため、可能なら fallocate を使うほうが無駄がなくて良いと思います。参考記事: Linuxでサイズ指定してダミーファイルを作成する方法 - conf t2. 関連するカーネルパラメータを GRUB（ブートローダー）に追加する/etc/default/grub を以下のように変更しました。/swapfile が、どのデバイスの、どの位置（オフセット）に存在するかを教えています。--- /tmp/grub.orig2021-08-25 01:12:57.415049508 +0900+++ /etc/default/grub2021-08-23 23:42:08.875333968 +0900@@ -2,7 +2,7 @@ GRUB_TIMEOUT=5 GRUB_TIMEOUT_STYLE=hidden GRUB_DISTRIBUTOR=\"Manjaro\"-GRUB_CMDLINE_LINUX_DEFAULT=\"quiet apparmor=1 security=apparmor udev.log_priority=3\"+GRUB_CMDLINE_LINUX_DEFAULT=\"quiet apparmor=1 security=apparmor udev.log_priority=3 resume=UUID=52d772c6-e49d-4be0-9963-c9aae2a9e4f9 resume_offset=52037632\" GRUB_CMDLINE_LINUX=\"\" # If you want to enable the save default function, uncomment the followingGRUB_CMDLINE_LINUX がユーザー用の変数かと思い、初めはこれを使ってしまいましたが、リカバリモード用でした（GNU GRUB Manual 2.06: Simple configuration）。\"resume=UUID=52d772c6-e49d-4be0-9963-c9aae2a9e4f9\" で、/swapfile が置いてあるデバイスを教えています。雑に調べると /dev/nvme0n1p5 です。/swapfile なので当たり前ですが、\"/\" がマウントポイントです。$ df /swapfileFilesystem 1K-blocks Used Available Use% Mounted on/dev/nvme0n1p5 527306168 62862840 437583404 13% /\"resume=/dev/nvme0n1p5\" でも問題はないとは思いますが、外付けストレージの追加等で名前が変わるリスクはゼロではないため、UUID による永続的な命名方法を使いました。各デバイスの UUID 確認方法は簡単です（永続的なブロックデバイスの命名 - ArchWiki）。$ ls -alF /dev/disk/by-uuidtotal 0drwxr-xr-x 2 root root 100 8月 24 00:14 ./drwxr-xr-x 8 root root 160 8月 24 00:14 ../lrwxrwxrwx 1 root root 15 8月 24 00:14 2E80-83B2 -\u003e ../../nvme0n1p1lrwxrwxrwx 1 root root 15 8月 24 00:14 52d772c6-e49d-4be0-9963-c9aae2a9e4f9 -\u003e ../../nvme0n1p5lrwxrwxrwx 1 root root 15 8月 24 00:14 DA82730D8272ECFF -\u003e ../../nvme0n1p4\"resume_offset=52037632\" で、/swapfile が /dev/nvme0n1p5 の先頭からどの位置（オフセット）に存在するかを教えています。filefrag というコマンドで分かるようです。$ sudo filefrag -v /swapfile | head -n 5Filesystem type is: ef53File size of /swapfile is 19327352832 (4718592 blocks of 4096 bytes) ext: logical_offset: physical_offset: length: expected: flags: 0: 0.. 0: 52037632.. 52037632: 1: 1: 1.. 2047: 52037633.. 52039679: 2047: unwrittenext4 はフラグメンテーションが起きづらいそうだけど、e4defrag で手動デフラグしたらオフセットは変わり得るのでは？と思いました。ちょっと怖いな。どうなんでしょう？/etc/default/grub を変更したら /boot/grub/grub.cfg を再作成します。$ sudo grub-mkconfig -o /boot/grub/grub.cfg3. 関連するフックを initramfs に追加する/etc/mkinitcpio.conf を以下のように変更しました。カーネル起動時に resume というモジュールがロードされるのかな。filesystems の前に追加するのがとても重要だそうです。--- /tmp/mkinitcpio.conf.orig2021-08-25 01:40:50.793227026 +0900+++ /etc/mkinitcpio.conf2021-08-23 23:07:04.396638336 +0900@@ -49,7 +49,7 @@ # ## NOTE: If you have /usr on a separate partition, you MUST include the # usr, fsck and shutdown hooks.-HOOKS=\"base udev autodetect modconf block keyboard keymap filesystems fsck\"+HOOKS=\"base udev autodetect modconf block keyboard keymap resume filesystems fsck\" # COMPRESSION # Use this to compress the initramfs image. By default, gzip compression/etc/mkinitcpio.conf を変更したら /boot/initramfs-*.img を再作成します。$ sudo mkinitcpio -p linux510linux510 は /etc/mkinitcpio.d/ 以下のファイルと対応していました。今回は /etc/mkinitcpio.d/linux510.preset しかなかったので、linux510 になりました。ちなみに mkinitcpio を引数なしで実行すると、dry run モードによる確認が出来ます。$ sudo mkinitcpio==\u003e Starting dry run: 5.10.59-1-MANJARO -\u003e Running build hook: [base] -\u003e Running build hook: [udev] -\u003e Running build hook: [autodetect] -\u003e Running build hook: [modconf] -\u003e Running build hook: [block] -\u003e Running build hook: [keyboard] -\u003e Running build hook: [keymap] -\u003e Running build hook: [resume] -\u003e Running build hook: [filesystems] -\u003e Running build hook: [fsck]==\u003e Generating module dependencies==\u003e Dry run complete, use -g IMAGE to generate a real image注意点GRUB や Linux カーネルが更新されたら、2 や 3 の再設定が必要みたいです。面倒なので私は mitamae でゆるふわ構成管理しています。まとめハイバネート出来た時は、思わずおぉー！と声が出ました。他の OS では当たり前すぎるハイバネートですが、自分で設定すると感慨深いものがあります。これで VivoBook から気軽に AC 電源コードを抜けるようになりました。なんと当たり前な...。今までは気がつくと電源が落ちていたので、AC 電源コードも気も抜けませんでした。😭サスペンドは復帰時に画面が表示されず、電源ボタンを長押しするしかなくなることがあるので、まだ使えていません。前述の「サスペンドとハイバネート - ArchWiki」によると、この現象は多数報告されているそうです。そして、そのデバッグのベストプラクティスがこの記事とのこと。長いので気が向いたら調べます。たぶん、Linux カーネルと ATI のドライバの相性（）が悪いのだと思います。他の参考記事・Arch Linux 快適デスクトップ環境の構築 2019 - Qiita・Linux におけるラップトップマシン向け電力管理スイートの紹介（Pm-utils, Laptop-mode-tools, Powertop, TLP） – 怠惰の形而上学初めからインストールされていた TLP があればサスペンド（スリープ）は問題なく管理されているそう。Laptop-mode-tools はもう古いそう。なのにサスペンドだけだと数時間しかバッテリーがもたないのは、推して知るべし...。","link":"https://masutaka.net/chalow/2021-08-25-1.html","isoDate":"2021-08-25T14:59:59.000Z","dateMiliSeconds":1629903599000,"authorName":"masutaka"},{"title":"私が１年かけて辿り着いた Looker の情報収集方法を紹介する","contentSnippet":"こんばんは、徳川家ｙ id:masutaka26 です。以前紹介したように、去年から Looker を使ったウェブ広告数値の可視化や BI *1 に取り組んでいます。LookML 開発者として LookML を書き始めて困ったのが、Looker の情報が少ないように見えたことです。LookML を含む Looker のドキュメントは充実しているのですが、それらを組み合わせた応用的なフロー情報が少なく感じました。ビジネスユーザー向けの情報も同様です。現在は網羅的、かつ集約した情報を取得できているので、その方法をご紹介します。「情報源」をリストアップする少し脱線...「情報源」の取得方法への課題今はどうなったか？「Looker Community」のフィードが存在した件「Looker の記事一覧 | DevelopersIO」のフィードを作った件まとめ追記「情報源」をリストアップする初めはこれらをたまに見に行ったり、Slack の /feed subscribe *2 で購読したりしてました。Looker Community公式フォーラム。英語で Question や Conversation が出来るLooker 日本語コミュニティフォーラム「Looker Community」の日本語版。Release Notes の日本語訳には本当に感謝 🙏「ニュースと告知」「ヘルプとサポート」「コラム」はそれぞれ Subscribe 出来る。メールで通知される  Looker 日本語コミュニティフォーラムLooker APAC Forum | Facebookリリース案内や事例紹介などLooker の記事一覧 | DevelopersIOご存知クラスメソッドさんのブログ。国内最多の記事量と投稿頻度Lookerの記事一覧 | ZennZenn にもそれなりの頻度で投稿されるLooker - QiitaQiita はもう少し頻度は落ちるかな#looker lang:ja - Twitter 検索以上の情報をふわっと取得できる。looker lang:ja や #looker だとノイズが多いのでこれに落ち着いた少し脱線...Looker Community には過去一度だけ質問しました。How do I dynamically switch view name in sql parameter of dimension? | Looker Community私は日本語サポートに頼ることが多い傾向です。最近はだいぶ減らせています。扱う情報を外に出せないので、外に出せるところまで昇華するのは難しいですね。🌀Looker の水野さんが日本語訳して下さっている、Looker のリリースノート *3 は、去年の 12 月から社内向けにこんな記事を書いて、Looker に徹底的に向き合うようにしています。Looker 21.12 のリリースノートを眺めてみた今まで書いた記事です。Looker のリリースノートを眺めてみたシリーズ「情報源」の取得方法への課題RSS/Atom（フィード）を配信していないサイトがほとんどで、見に行くのがかなり面倒でした。そのものズバリなフィードは Zenn と Qiita だけです。クラスメソッドさんは Looker タグのフィードが存在せず、当時は Twitter で捕捉してました。今はどうなったか？ほぼすべてを社内の Slack channel #news-looker に集約させることが出来ました。以下が実際に購読しているフィードです。https://community.looker.com/feed/buzzcapture「Looker Community」のフィード。後述するhttps://feed43.com/developersio-looker.xml「Looker の記事一覧 | DevelopersIO」のフィード。後述するhttps://zenn.dev/topics/looker/feed「Lookerの記事一覧 | Zenn」のフィードhttps://qiita.com/tags/looker/feed「Looker - Qiita」のフィードTwitter は IFTTT を使って、同 channel に POST しています。If New tweet from search #looker lang:ja -rtThen Post to channelChannel: #news-lookerMessage: @{{UserName}} : {{Text}} (via Twitter {{LinkToTweet}})「Looker APAC Forum | Facebook」は集約できませんでしたが、Twitter にも流れることがあるので、一旦考えないことにしました。「Looker Community」のフィードが存在した件Looker の水野さんに聞いたら、調べて教えて下さいました。🙏(1) 新しいトピックの投稿https://community.looker.com/feed/topics(2) 全ての新しい投稿（最初の投稿（タイトル＋ボディ）+ 全てのリプライ）https://community.looker.com/feed/buzzcaptureアナウンス記事です。LookerコミュニティのRSSフィード | Looker Community(1) と (2) は両方とも「Looker 日本語コミュニティフォーラム」の情報も流れてきます。今は (2) を購読しており、トラフィックはそれなりにあります。もちろんほぼ全て英語です。辛かったら (1) にすると良いと思います。https://community.looker.com/ の HTML には RSS/Atom 情報がないので、これらのフィードに気づける人は少ないと思います。Looker さんには是非お願いしたいところです。「Looker の記事一覧 | DevelopersIO」のフィードを作った件ないものは仕方がないので、Feed43 というサービスで作りました。出来たのが https://feed43.com/developersio-looker.xml です。どなたでも購読可能です。よろしければどうぞ。HTML をパースしているだけなので、HTML 構造が変わったら壊れることはあると思います。気づけたら直します。本当は https://dev.classmethod.jp/tags/looker/ のフィードがあれば良いのですけどね。今後に期待です。[Update] そのものズバリ https://dev.classmethod.jp/feed/?tag=looker を Twitterで教えて頂きました。ありがとうございます！まとめ私が１年かけて辿り着いた、Looker の情報取得方法をご紹介しました。これで Looker の情報は大量にインプット出来たので、今後はコミュニティにアウトプットしていきます。🔥※ ネタは少しあるけど、時間がない。(^^;皆さんにも参考になれば幸いです。他にもあれば @masutaka に教えて下さい！追記他にもあれば @masutaka に教えて下さい！記事にも登場して頂いた Looker の水野さん @tomoya_cs をフォローするとさらに捗ると思います。Lookerの情報収集本当に至難と思いますが、まとめていただきありがとうございます😭あとは私をフォローいただけると最新情報が入手しやすくなるかと（アウトプットがんばります🙇‍♂️） https://t.co/eDQz8A5VCC— tomoya | Looker CS (@tomoya_cs) 2021年8月19日  *1:Business Intelligence*2:Slack に RSS フィードを追加する | Slack*3:例: Looker 21.12 リリースノート | Looker Community","link":"https://developer.feedforce.jp/entry/2021/08/16/150000","isoDate":"2021-08-16T06:00:00.000Z","dateMiliSeconds":1629093600000,"authorName":"masutaka"},{"title":"Chrome から Firefox に乗り換えたよ","contentSnippet":"[2011-06-03-1] に Firefox から Chrome に乗り換えて以来です。ちょうど 10 年。iPhone から Android への乗り換え [2020-07-14-1] も 10 年だったし、飽きづらいマスタカも 10 年が周期みたいです。まあ、普通の人は乗り換えたことをいちいち記録しないし、もっとカジュアルにあっちこっち使う気はしてます。このブログの名前が「マスタカの ChangeLog メモ」なので記録せざるを得ないのです。もう大変。(\u003eo 買えよ (^^;loading...loading...今回は乗り換えのハードルを低くするために個人 PC だけ乗り換えました。PC も速くなった [2021-05-06-1] ので、2019 年とは違います。会社の MacBook Pro はまだ（？）Chrome です。Firefox でまず戸惑うのが、Chrome のユーザー（プロファイル）切り替えに相当する機能が見当たらないことです。4 年前と変わらず、なぜか Multi-Account Containers を推してきますが、これはタブ単位でセッションを切り替える機能です。Firefox アカウントは切り替えられないので代わりにはなりません。代わりに \"about:profiles\" が使えます。アドレスバーにこれを入力して開くと、素朴な画面が開いてプロファイルの管理や起動が出来ます。\"$ firefox -P\" などと \"-P\" オプション付きで Firefox を開いても、似た機能を持つプロファイルマネージャーが起動します。公式ヘルプ: プロファイルマネージャーを使用して、Firefox のプロファイルを作成または削除する｜Firefox ヘルプ前回と同じように、私が使う数少ないアドオンの乗り換え記録も残しておきます。各タイトルは Chrome 拡張名です。1Passwordこれは普通にあります。X は気にしないでください。1Password X – パスワード保管庫Chrome 版は２つあって初心者を悩ませそうです。前者が X です。気にしないでください...。1Password – パスワード保管庫1Password 拡張機能 (パソコンのアプリが必要)ato-ichinenON にしている間、Google 検索を直近 1 年にするだけの Chrome 拡張です。技術系の調査は鮮度が大事なことがあるからです。よく考えたらブックマークレットで十分なので、こんなのを作りました。どうでも良いですが、名前は G1nen にしました。javascript:location.href=location.href+'\u0026tbs=qdr:y'ついでに G2en というブックマークレットも作りました。これは Google の検索対象を英語サイトにします（情報源）。日本語の情報はノイズになることが多いので。だったら常に英語にしろよという意見は認めます。javascript:location.href=location.href+'\u0026gl=us\u0026hl=en\u0026gws_rd=cr\u0026pws=0'Create Link今開いているページや選択したリンクを、Markdown や任意のフォーマットでクリップボードにコピーする Chrome 拡張です。esa とか書いてるとよく使いますよね。Format Link に移行しました。若干上位互換風で、正規表現を使った置換も出来ます。Emoty絵文字を一覧から選んでクリップボードにコピー出来る Chrome 拡張です。フォーマットは :smile: などで、Unicode 絵文字ではありません。Emoji Cheatsheet に移行しました。こちらは Unicode 絵文字にも対応しています。Google Analytics オプトアウト アドオン (by Google)その名の通りの Chrome 拡張です。Chrome の機能を使って、自分のサイトや会社のサイトだけをオプトアウトしていました。宗教上の理由（）がないので、全サイトはオプトアウトしていません。良さげなアドオンが見つかっていません。情報求む。Google 翻訳その名の通りの Chrome 拡張です。選択範囲だけを翻訳したり、ページ全体を日本語に置き換えたり便利ですよね。To Google Translate に移行しました。https://translate.google.com/ が別タブで開いてしまうので大げさではあります。まあいいか...。Grammarly for Chromeスペルチェッカーサービス Grammarly の Chrome 拡張です。今年も気がついたら課金していたので、来年は課金しないようにしました。Grammarly for Firefox があります。ただ、Chrome と違って動作するサイトを絞れないので、フォームへの書き込みを邪魔することが多いです...。Keepa - Amazon Price TrackerAmazon の商品ページに価格変動グラフを挿入してくれる Chrome 拡張です。「安くなった。買い時だ。」「高いけど買っちゃおう。」などと判断の助けになります。← 結局買う奴Amazon Price Tracker - Keepa.com があります。LINELINE の Chrome アプリです。長めの文章が面倒な時に使ってました。Firefox 版はないみたいです。LINE をあまり使わないので問題なし。Save to PocketPocket の Chrome 拡張です。結局 Pocket に戻って来てしまいます。Firefox にはこの機能が組み込まれています。2015-04-21 にそんなニュースがありました。速報： MozillaがPocket（旧Read It Later）をFirefox本体に統合（追記あり） - Mozilla Fluxtwitter画像原寸ボタンtwitter.com や TweetDeck で小さくて見づらい画像を原寸サイズで、別タブにバババッと開く Chrome 拡張です。Twitter 原寸びゅーに移行しました。モーダルで開き、ショートカットキーでサイズを変えられるので、こちらの方が便利です。はてなブックマークご存知はてブの Chrome 拡張です。Hatena Bookmark があります。なぜか英語。新たに Firefox にインストールしたアドオンChrome では要らなかったが、Firefox でインストールしたアドオンを書いていきます。Copy Link Textリンクテキストをコピーするアドオンです。↑ だと \"Copy Link Text\" をコピーできます。信じられないことに Firefox ではこれが出来ないのです。4 年前のやつが残ってて、何をするアドオンか思い出すのに時間がかかりました...。Firefox で不要になったアドオン反対に、Chrome で使っていたが、Firefox で代わりは要らなかった Chrome 拡張を書いていきます。Close download barファイルをダウンロードすると現れるうざいフッターを Option-w や Alt-w で閉じられる Chrome 拡張です。地味だけど便利です。まとめ10 年ぶりに Firefox に戻ってきました。1 週間使っていますが、課題はありつつも、Firefox だと忘れてしまう程度には主張してきません。割と快適です。アドオンがエラーを起こすのはたまたまなんですかね？この記事を書いている間、Format Link が使えませんでした...。","link":"https://masutaka.net/chalow/2021-08-07-1.html","isoDate":"2021-08-07T14:59:59.000Z","dateMiliSeconds":1628348399000,"authorName":"masutaka"},{"title":"３月に無償提供となった Microsoft Power Automate Desktop を今さらながら使ってみた","contentSnippet":"※ 会社の「インフラ共有会」用に書いた記事の転載です。Windows PC を買った [2021-05-06-1] ので、個人で試せることに気づいてちょろっと試したって経緯です。Microsoft、自社製RPAツールを全Windows 10ユーザーに無償提供　マウスクリックやキーボード入力をGUIで自動化：Microsoft Ignite 2021 - ITmedia NEWS・動作するのは目の前の Windows PC。エクセルとかのマクロをパワーアップしたものに近いかも・ スケジュール（時間を指定した自動実行）の機能は見つけられなかった。寝ている間に自動実行とかは出来ない気がした・Chrome の「要素を検証」みたいな感覚で、クリックやフォームの位置を指定できる・要素名を変更するなど細かい微調整は出来ないようなので、id 名等が少しでも変わるとフローが動かなくなるかも・アクションの種類は多彩で、頑張れば「LINEビジネスアカウントでログインして、レポートをローカルフォルダにダウンロードし、それを Google スプレッドシートにインポート」は出来ると思う・今起動しているブラウザにも接続できるようなので、２段階認証突破のハードルは多少低そうPower Automate と Power Automate Desktop との違いはイマイチ理解できていない。難しい...。・Power Automate・Power Automate Desktop ← 今回はこっち多彩なアクション※ フローの新規作成画面です。[多彩なアクション]フローを作った様子https://www.myfitnesspal.com/ja/account/login にログインして csv ファイルをダウンロードするフローを作ったが、MyFitnesspal は「CSV ファイルをダウンロードするためのリンクを含んだメールが届きます」だと知った。試しに作るには大きすぎるため心が折れた。(^^;[設定例]インストール方法や実行方法などの紹介動画うぃんどうずしょしんしゃなので、わかりやすいどうがをみたよ。","link":"https://masutaka.net/chalow/2021-07-28-1.html","isoDate":"2021-07-28T14:59:59.000Z","dateMiliSeconds":1627484399000,"authorName":"masutaka"},{"title":"『ここがつらいよ普段使いのLinux』という発表をした","contentSnippet":"こんにちは id:masutaka26 です。いよいよ明後日は RIZIN.28 ですね！東京ドームで MMA（総合格闘技）のイベントが行われるのは、約 17 年半ぶりだそうです（Wikipedia 調べ）。ドキが胸胸します。本日、週次の社内勉強会 FFTT で『ここがつらいよ普段使いのLinux』という発表をしました。タイトルは違いますが、気にしないで下さい。Mac が重い時に IME 切り替えが一瞬遅れて、例えば「feedforce」とタイプする時に「ふぇえ...」になる現象に悩まされていました。そこで約 10 年ぶりに Windows PC を購入して、同じく約 10 年ぶりに Linux を普段使いし始めました。数々の諸問題が発生しましたが、無事全部解決（？）したお話です。キーボードショートカットがつらいタッチパッドがつらい指紋認証出来なくてつらいたまにスリープから復帰しなくてつらい（一番つらい）ちょっとした画像編集に GIMP を使うのはつらいみんなも Mac を捨てて Linux を使うといいと思うよ！それでは！だれでもできるLinuxセットアップ―無料(ただ)なのに頼れるOSリヌクス作者:鈴木 哲哉オーエス出版Amazon","link":"https://developer.feedforce.jp/entry/2021/06/11/180000","isoDate":"2021-06-11T09:00:00.000Z","dateMiliSeconds":1623402000000,"authorName":"masutaka"},{"title":"Dependabot の Terraform 1.0 対応が完了した件","contentSnippet":"[2021-05-27-1] のつづき。この間に 1.0 がリリースされてましたね。先ほど、Lockfile (.terraform.lock.hcl) の対応が完了したそうです。https://github.com/dependabot/dependabot-core/issues/1176#issuecomment-858490407これで Dependabot での terraform 対応が完了しました。・terraform version は自動更新できない・provider version を自動更新できる。その際、.terraform.lock.hcl も更新されるはず・以前の Dependabot で対応されていた module version はどうなんだろう？使ってないので分からないdependabot.yml のドキュメントはこちら。circleci-tfupdate-orb はそろそろアーカイブしたいな。でも Dependabot だと terraform version は更新出来ないんだよね...。追記(2021-06-11):公式でもアナウンスされてました。Dependabot now supports Terraform 1.0｜GitHub Changelog","link":"https://masutaka.net/chalow/2021-06-10-1.html","isoDate":"2021-06-10T14:59:59.000Z","dateMiliSeconds":1623337199000,"authorName":"masutaka"},{"title":"暑がりの私にはマスクチェーンがとても合ってる","contentSnippet":"去年の秋くらいからマスクチェーン（ストラップ）を使っています。私はとても暑がりなのと、マスクの着用感が好きではないので、かなり重宝しています。どのくらい暑がりかと言うと、中学生の時は暑くない水泳部に入ったり、毎日スーツを着る会社には絶対に入社しなかったり、今の会社が上場した時も暑かったので（スーツが必要な）東証には行かなかったり、まあそんな感じです。外に出た時にスッと外せるのがとても良いです。店で...","link":"https://masutaka.net/chalow/2021-05-30-1.html","isoDate":"2021-05-30T14:59:59.000Z","dateMiliSeconds":1622386799000,"authorName":"masutaka"},{"title":"Dependabot の Terraform 0.15 対応が進んでいる件","contentSnippet":"最近この Issue が活発になってきました。Terraform 0.15 support · Issue #1176 · dependabot/dependabot-core実はプロバイダーバージョンのアップデートだけならもう使えます。・プロバイダーバージョンのアップデートはもう動く・↑の後に必要な .terraform.lock.hcl の更新は実装中とのこと。現在は手動で \"$ terraform init -upgrade\" が必要・terraform バージョンのアップデートはロードマップに含まれていない↓プライベートリポジトリで動いている様子。[dependabot terraform1][dependabot terraform2]dependabot.yml のドキュメントはここにあるので、試してみるのも良いかもしれません。↓このブログが置いてあるリポジトリの .github/dependabot.yml です。daily はやり過ぎなのであとで減らそう。version: 2updates: - package-ecosystem: \"terraform\" directory: \"/terraform/aws\" schedule: interval: \"daily\" time: \"12:00\" timezone: \"Asia/Tokyo\" assignees: - \"masutaka\" open-pull-requests-limit: 10 - package-ecosystem: \"terraform\" directory: \"/terraform/heroku\" schedule: interval: \"daily\" time: \"12:00\" timezone: \"Asia/Tokyo\" assignees: - \"masutaka\" open-pull-requests-limit: 10今までの経緯とかTerraform 0.11 まで、Dependabot はモジュールのアップデートだけ対応していました。https://dependabot.com/docs/config-file/ でその痕跡を確認できます。※ Dependabot は GitHub に統合されたので、https://dependabot.com はもう古いです。ですが、Terraform 0.12 で HCL2 が導入されてから、全く動かなくなりました。前述の Issue も要望の嵐。@minamijoyo が tfupdate を作ってくれたので、私もその CircleCI Orb を作ってみるなど。※ 現在この Orb は terraform 本体とプロバイダーバージョンのアップデートのみ対応しています。terraform.lock.hcl の更新には対応していないので、手動で $ terraform init -upgrade が必要です。https://github.com/minamijoyo/tfupdate-circleci-example のサンプルコードは対応しているみたいです。","link":"https://masutaka.net/chalow/2021-05-27-1.html","isoDate":"2021-05-27T14:59:59.000Z","dateMiliSeconds":1622127599000,"authorName":"masutaka"},{"title":"ノートパソコンクーラーを買い替えた","contentSnippet":"2 年使っていた冷却パッドが寿命っぽいので、エレコムのノートパソコンクーラーを買いました。心配していた冷却効果は申し分なく、ひとまずホッとしています。元々こちらの冷却パッドを使っていました。ゲーミング PC 向けみたいです。この動画お気に入りです。つい何度も見てしまう中毒性があります。少々デカイのが難点でしたが、冷却効果は申し分ありませんでした。ただ 2 年も使うとホコリが溜まってきます。分解は無理そう...","link":"https://masutaka.net/chalow/2021-05-23-1.html","isoDate":"2021-05-23T14:59:59.000Z","dateMiliSeconds":1621781999000,"authorName":"masutaka"},{"title":"全ての esa 新着記事を読みきれないので、最近はこの方法を使ってる","contentSnippet":"こんにちは id:masutaka26 です。最近好きな YouTuber はシバターです。シバターかわいいよ...。シバター...フィードフォースでは先日紹介したとおり、ドキュメント共有ツールに esa を使っています。メンバー数は 90、デイリーアクティブメンバーは 69 くらいです。2/10 の新着記事数は 106 でした。情報共有が活発な会社で、体感でもとても多いです。全ての新着記事と記事へのコメントは Slack の #esa-notify に通知されます。そこを全部読めば追えはしますが、いかんせんこの数です。真面目に全部読むと、私の場合はかける時間に見合わないなと感じたので、最近は esa の検索を利用した方法を使っています。使っている方法フォローした人の新着記事を読むエゴサーチする気になるキーワードに言及した新着記事を読む日報以外の最近更新された記事を読む直近の記事を読む公式ドキュメントちょっとした悩み所感おまけ: ボツにした方法使っている方法フォローした人の新着記事を読む検索クエリの例:@alice OR @bob OR @sapp sort:created-desc🔖 ブラウザのブックマーク: Follow上の例では alice, bob, sapp をフォローしているイメージです。社長やプロダクトオーナーをフォローして、最近の会社の状況を把握するようにしています。他、自分が関心がある人もフォローしています。メンバーは固定ではなくたまに入れ替えます。現在 16 人をフォローしています。エゴサーチする検索クエリの例:マスタカ -@me OR ますたか -@me OR masutaka -@me OR 増田 -@me sort:created-desc🔖 ブラウザのブックマーク: Egosearch「マスタカ」「ますたか」「masutaka」「増田」が含まれ、且つ自分の記事を除いた新着記事を全部読んでいます。空メンション masutaka やアイコン絵文字 :@masutaka:、\u003c!-- Boku ha masutaka nari. --\u003e のような HTML コメントも捕捉出来ます。👁気になるキーワードに言及した新着記事を読む検索クエリの例:looker -@me sort:created-desc🔖 ブラウザのブックマーク: Search Looker「looker」が含まれ、且つ自分の記事を除いた新着記事を全部読んでいます。日報以外の最近更新された記事を読む検索クエリの例:-category:日報 sort:updated-desc🔖 ブラウザのブックマーク: 日報以外日報/ カテゴリ以外で、最近更新された記事をたまに読んでいます。新着記事でないことがポイントです。良さそうな WIP 記事を先取りできることがあります。🤗直近の記事を読む退勤後とかは、新着記事一覧 /posts も見ます。公式ドキュメントここまで使った検索クエリは、公式ドキュメント「help/記事の検索方法」に書かれています。OR 検索よりも AND 検索のほうが優先度が高いとは書かれていないので、行間を読む必要があります。括弧は使えないので、前述の「エゴサーチする」は自分にとって難易度が高かったです。esa の皆様、その節はサポートありがとうございました。🙏ちょっとした悩みスマホだと「フォローした人の新着記事を読む」が検索対象のメンバーアイコンで埋まるので、結構スクロールしないと記事にたどり着けません。メンバーアイコンと記事の境界も曖昧で、スクロールしすぎることがあります。スマホだと数スクロールがメンバーアイコンで埋まるもう少しメンバーアイコンのサイズが小さいと良いと思います。ﾁﾗｯﾁﾗｯ所感全ての新着記事を読む代わりに、テーマを決めた複数の方法で esa 記事を読み、かける時間を減らしました。２ヶ月ほど使っており、なかなか満足しています。ただ、関心外のことが入って来づらくなることは、特にこのフルリモートワーク下では怖さを感じます。カッチリやらずに、たまに #esa-notify を覗けばよいのですけどね。記事へのコメントだけを通知する Slack チャンネルでも作れば良いのかしら？おまけ: ボツにした方法コメントもエゴサーチしようとしましたが、なんか期待通りの振る舞いではなかったです。comment:マスタカ OR comment:ますたか OR comment:masutaka OR comment:増田 sort:created-descコメント本文はきちんと検索出来ているようですが、検索結果はあくまで（コメント単位ではなく）記事単位なので、すでに読んだ記事のことが多いからかな？他の方法で網羅できているようなので、まあいいかあと思いました。","link":"https://developer.feedforce.jp/entry/2021/02/15/110000","isoDate":"2021-02-15T02:00:00.000Z","dateMiliSeconds":1613354400000,"authorName":"masutaka"},{"title":"変化に耐え得る esa のカテゴリ設計を徹底的に考えてみた","contentSnippet":"こんにちは id:masutaka26 です。夜の散歩（意味深）に勤しむ毎日です。フィードフォースではドキュメント共有ツールには esa と Google ドキュメント1を、コミュニケーションツールには Slack を採用しています。情報共有はかなり活発で、2021/2/1 現在の esa 記事数は 81,324 です2。現在のカテゴリ構成と課題チームのスピードを上げるための大原則チームのスピードを上げるための情報整理1. Flow 型と Stock 型の記事を理解する2. 基本は Flow 型の記事にする3. 議事録カテゴリは出来るだけ作らない4. Slack に流れていく情報も Flow 型の記事にする5. 使い続けられる情報を Stock 記事として引き上げる6. 整理を頑張らないことで整理の難易度が低くなった7. esa を全ての情報の起点にするそれをチームでやるのは難しすぎない？esa は難しいesa の本当の正体esa への要望まとめesa 公式アカウントからのアドバイスコラム記事のカテゴリ整理を頑張らない理由Flow カテゴリをどこまで許容するか現在のカテゴリ構成と課題トップカテゴリは厳密にルール化されていて、これらの種類以外のカテゴリが増えることはありません。日報/2021/02/01 (月)/masutaka といった記事が置かれる曜日がないなど、型から外れた日報は小人さんによって速やかに修正される。Bot 並に早いwプロダクト1/実際には Feedmatic などのプロダクト名が入る︙プロダクトN/プロジェクト/期間が決まっている系のプロジェクトカテゴリが並ぶチーム/人事や情報セキュリティなどのチーム系カテゴリが並ぶコミュニティ/技術系や読書会などのコミュニティ系カテゴリが並ぶノウハウ/各種ツールのノウハウ系カテゴリが並ぶFeedforce Inc./会社全体に関係する記事が置かれるUsers/Templates/Archived/例えば「プロダクト1」の下は、議事録系を除き基本的に Stock 型の記事になっており、「マニュアル」カテゴリの下にはさらに 15 の子カテゴリが生えているとします。プロダクト1/議事録/開発/コンサルティング/マーケティング/インシデント/ナレッジ/マニュアル/子カテゴリ数は 15︙その他/※ 複数のプロダクトから作った架空カテゴリです。ここまでならよく整理されているように見えますが、実際は古くてメンテナンスされていない記事が多く、言ってしまえばノイズが多い状況です。情報共有されればされるほど、ノイズが増えてしまう悪循環です。Slack に目を向けると、こちらもオープンではありますが、時にブログ記事並みのメッセージが投稿されることがあります。未読メッセージを読み進めると手が止まり、読み切るのが難しいと想像されます。ブログ記事並みのメッセージ例。これで半分です。細切れの情報も多く川の流れのようで、断片化した情報をつなぎ合わせるのは難しいと思います。世の中には情報共有が足りないことに悩む組織は多いと思いますが、活発になったとしても、適切に整理されていなければその量に溺れてしまいます。一方で、最近のコロナ禍もあって 10 年前と今とでは変化のスピードは上がっています。変化に強いチーム設計、つまりは変化に強い情報整理設計が重要です。これをやらなければ、チームのスピードは徐々に下がっていくでしょう。チームのスピードを上げるための大原則私が社内で様々なプロダクトを渡り歩いた経験上、チームのスピードを上げるためには以下の 2 点が重要だと感じています。ノイズを減らす情報を一ヶ所に集めるマネージャーはこれらの阻害要因を減らす仕掛けを作る必要があります。ただ、そういったことが得意な方ばかりではありません。むしろ情報量が一番多く、一番困っているのは彼らかもしれません。マネージャーに余裕がなければ、それがボトルネックとなりチームのスピードが下がります。これからその対策を考察していきます。チームのスピードを上げるための情報整理はじめに書いておくと、出来るだけ整理を頑張らないことが重要です。1. Flow 型と Stock 型の記事を理解するまずは公式ドキュメント「記事のストック・フローの分類と検索」を読んで、Flow 型と Stock 型の記事の存在を知り、理解します。2. 基本は Flow 型の記事にする全て Flow 型にするくらいの気持ちで記事を作ります。記事が多くなっても視界に入りづらいし、整理する必要もないためです。Flow 型記事の例書き捨ての記事であれば プロダクト1/2021/02/01/タイトル、今月中は更新する記事であれば プロダクト1/2021/02/タイトル で良いと思います。ただ、さすがに今年中更新する記事は Stock 型の記事にしたほうが良いと思います。3. 議事録カテゴリは出来るだけ作らないプロダクト1/議事録/ のような議事録カテゴリはできるだけ作らず、プロダクト1/2021/02/01/〇〇会議 議事録 のようなカテゴリとタイトルにします。議事録のような使い続けない記事を視界に入れるのは、どちらかと言えばノイズだからです。社内で以下のような階層をよく見かけますが3、一回限りの会議の置き場所に悩んでしまいます。プロダクト1/議事録/〇〇会議/YYYY/MM/DD/〇〇会議プランニング/YYYY/MM/DD/プランニングプロダクト1/議事録/20210201 〇×会議 議事録 のような自由なパターンも現れたりして、さらに悩ましくなります。過去の議事録をたどる目的でカテゴリを分けたいのであれば、記事の最初に「議事録一覧はこちら」みたいな検索リンクがあれば十分でしょう。「議事録一覧はこちら」の一例それでも作りたい場合は プロダクト1/議事録/〇〇会議/2021/02/01/〇〇会議 議事録 のような記事名にして、後から プロダクト1/2021/02/01/〇〇会議 議事録 に一括変換して視界から消せるように、設計するのが良いと思います。一括変換の仕方は公式ドキュメント「記事のカテゴリを一括変更」が分かりやすいです。4. Slack に流れていく情報も Flow 型の記事にするSlack にはブログ記事並みのメッセージが投稿されることがあります。そうなりそうになったら迷わず プロダクト1/2021/02/01/○○のお願い といった Flow 型の記事を作り、その URL を Slack で共有します。他の場面で引用したい時は意外とあるものですし、内容をあとで更新したいこともあります。Slack だと特にあとからの更新には不向きです。何より当該記事をブラウザで開き、残りの Slack 未読メッセージをスイスイと読むことが出来ます。Slack に投稿されてしまうと、その長いメッセージを読みながら、他の channel に移動するのは億劫です。5. 使い続けられる情報を Stock 記事として引き上げる結局のところ、ほとんどの情報は使い続けることはありません。具体的すぎるからです。そのような具体的な情報は寝かすことで、抽象度の高い情報、例えばカテゴリ名を炙り出せることがあります。良いカテゴリ名が思いつかない時は、まだ抽象度が高くないと思うので、引き上げないほうが良いでしょう。いくつかの Flow 記事をしばらく寝かしたら、あとから汎用的な抽象度の高い Stock 記事のアイディアが湧くこともあります。6. 整理を頑張らないことで整理の難易度が低くなったここまででほとんどの記事は Flow 型の記事のはずです。冒頭に述べたノイズになるような記事は少なく、情報に溺れる確率は低いと思います。使い回しが効かない具体的な情報を Flow 型の記事に追いやることで、整理の難易度を低くすることが出来ました。7. esa を全ての情報の起点にするでは、Google ドキュメントも同じようにしましょう！とは思っていません。esa を全ての情報の起点にする勢いで、適宜 Google ドキュメントにリンクを張ると良いでしょう。Google ドキュメントのフォルダ整理は出来るだけやらないほうが良いです。時間がいくらあっても足りません。Google Drive はただの情報プールです。Google Drive 内検索も優秀です。それをチームでやるのは難しすぎない？そう思った方、正しい感覚です。「チームのスピードを上げるための情報整理」は「私が考える esa 原理主義」に振り切って書きました。情報整理のスキルに関して少数精鋭チームでないと、運用するのは難しいと思います。現在私は開発者 1 人、ビジネスメンバー 2 人のチームに所属しています。私主導でカテゴリを決めているので、これまで書いた方法で整理し、うまくいっている実感があります。Flow 型の記事に対して、Stock 型の記事を少なく保てている。そういえば初期は Flow 型の記事しか作りませんでした。esa は難しいフィードフォースでは 1 年半ほど前まで Qiita:Team を使っていました。Qiita:Team はほぼ Flow 型の記事しか書けないため、これまで話した問題は出てきませんでした。いや「表面化しなかった」が正確でしょう。esa は Stock 型の記事も書けます。ブログと wiki が合体したようなツールなので、難しくないわけがありません。wiki を書くためには抽象的思考が必要です。私の観測範囲では、半分以上の方は具体的思考に寄り過ぎているため、得意ではないという実感です。意識したことがないかもしれません。esa の本当の正体正直言って現在の esa は「情報整理のスキルに関して少数精鋭チーム」でないと、乗りこなすのは難しいと思います。これに気づいた時、Ruby という言語に似ていると思いました。Ruby は esa で採用されているプログラミング言語です。初心者はにこやかに迎えてくれますが、本番環境で使い続けるためには、コードで表現されていない振る舞いを読み解く必要があるなど、実は少数精鋭チーム向けの言語です。esa LLC は少数精鋭チームのようなので、良くも悪くも「コンウェイの法則」が働いて、そのようなサービスになったのだと勝手に想像します。esa への要望社員数 100 人オーバーが見えてくると、型（制約）の必要性を感じます。新規作成時にデフォルトカテゴリが Flow 型になるような、型を設定できると良い？例: プロダクト1/ 以下での新規作成は、デフォルトカテゴリが プロダクト1/YYYY/MM/DD/ になるフレームワーク的に、何らかのパターン以外のカテゴリを作れないようにする？第一階層カテゴリ以下で、そのようなパターンを数種類から選べるようにする？どれも難しい話ですかね...？現在社内で抱えている課題として「記事整理にハードルがある」は間違いなくあると思います。たくさんの記事を移動すると、/posts がその情報で埋まる4移動しただけなのに、記事に自分の小さなアイコンが付くそもそも記事を 1 つ 1 つ移動するのが大変タイトルに入れてしまった日付をカテゴリにして...とかまですると、API を使わざるを得ない出来れば Windows のエクスプローラのようなカジュアルさで、且つ履歴が残るとうれしいです。あと、要望したことはありますが、現在の「カテゴリ以下の記事全て」に加えて、「カテゴリ直下の記事」「アーカイブした記事」を切り替えるような機能が欲しいです。イメージとしては、GitHub の UI に「カテゴリ直下の記事」を加えたものです。In, On, Archived を切り替えられるイメージ「カテゴリ直下の記事」は on:カテゴリ で検索できますが、知っているユーザーはごく僅かです。アーカイブの認知も怪しくて、古い記事が残る要因かもしれません。一部カテゴリではこんな工夫をしています。アーカイブという手段を認知させている例難しいと思いますが、情報整理のスキルがそれほど高くなくても使える UI 設計をお願いしたいところです。🙏もし、もっと詳しく私にヒアリングしたいなどあれば、masutaka@feedforce.jp または @masutaka の DM までお知らせ下さい。まとめ私から見える、フィードフォースで抱えている情報整理の課題をまとめ、チームのスピードを上げるための整理方法を提案しました。ただ、それは「私が考える esa 原理主義」に振り切っているため、チームで採用するのは難しいと思います。カテゴリがデフォルト Flow 型になるなど、情報整理を頑張らず済む使い勝手になると、とてもうれしいです。esa 公式アカウントからのアドバイス新規作成時にデフォルトカテゴリが Flow 型になるような、型を設定できると良い？こちらのアドバイスを頂いたので早速試しました。良さそうです！あるカテゴリ配下で \"Create a new post\" ボタンで記事を新規作成するときに、カテゴリが一致するFlowのテンプレートがあれば、そのテンプレートが自動的にプリセットされるという機能があります。（続く→）— esa_io (@esa_io) 2021年2月3日  例えば以下のテンプレートがあったとして- Templates/カテゴリ1/YYYY/MM/DD/テンプレートA- Templates/カテゴリ1/サブカテゴリ1/YYYY/MM/DD/テンプレートB「カテゴリ1」配下で記事作成→ テンプレートA 「カテゴリ1/サブカテゴリ2」配下で記事作成 →テンプレートB がそれぞれ自動適用されます— esa_io (@esa_io) 2021年2月3日  後日アンサー記事も頂きました！「所感」にこの記事の感想が書いてあります。ProTip/2021/02/03/特定のカテゴリ配下の記事作成時に、テンプレートを適用する - docs.esa.ioコラム自分の思いを書ききれないので、コラムに逃しました。(^^;記事のカテゴリ整理を頑張らない理由こんな理由からです。歴史が証明しているesa の検索がそこそこ優秀今では信じられないかもしれませんが、1990 年代の Yahoo! JAPAN は、人間のスタッフがウェブサイトの情報を収集してカテゴリ分類して登録する、ディレクトリ型検索サービスでした5。今はロボット型検索が使われているのは周知のとおりです。そのため Stock 型の記事だけを作り続けるといずれ破綻することは、1 歴史が証明していると言えます（やや大げさ）。2 については、公式ドキュメント「記事の検索方法」にある検索クエリで、それなりに検索できます（諸説あり）。「キーワード検索しやすい記事にするコツ」も参考にすると良いでしょう。Flow カテゴリをどこまで許容するかFlow カテゴリをどこまで許容するかは、悩ましいところです。(a) 制約をつけずに自由に作ることを許容するか。プロダクト1セールス...YYYYMMDD開発○○機能YYYYMMDDYYYYMMDDYYYYMMDD(b) 原理主義っぽく、１つの Flow カテゴリしか許容しないか。プロダクト1セールス...開発...YYYYMMDD(a) は職種横断的な情報共有を重視しないチームに合うと思います。中規模以上のチームです。(b) は職種横断的な情報共有を重視するチームに合うと思います。小さなチームです。はじめは (b) で作ってみて、やりづらくなってきたら (a) にすると良いでしょう。ただし、(a) の プロダクト1/開発/○○機能/YYYY/MM/DD/ まで細かく Flow カテゴリを作るのは、把握が難しくなりそうですので、オススメはしません。Google Workspace（旧称 G Suite）を契約しています。↩現在のメンバー数は 90、最古の記事は 2014/4/3 です。↩過去に推奨したことあります。ｽﾏﾇｽﾏﾇ…。↩Archived/ 以下への移動は更新日時が変わらず /posts に現れないので、カテゴリ一括変更と組み合わせれば、一応回避はできます。↩今回の件で調べたところ、その「Yahoo!カテゴリ」は2018年3月29日まで動いていたことを知りびっくりしました↩","link":"https://developer.feedforce.jp/entry/2021/02/03/110000","isoDate":"2021-02-03T02:00:00.000Z","dateMiliSeconds":1612317600000,"authorName":"masutaka"},{"title":"『4月から取り組んできたLookerの導入から実装までのお話（Redashとも比較）』という発表をした","contentSnippet":"こんにちは id:masutaka26 です。最近の趣味はリハビリと YouTube 鑑賞です。本日、週次の社内勉強会 FFTT で『4月から取り組んできたLookerの導入から実装までのお話（Redashとも比較）』という発表をしました。4 月から Feedmatic という弊社フィードフォースの広告運用サービスに BI ツールである Looker を導入すべく、検討と実装をしてきました。関わっているエンジニアは私一人で、社内の他のエンジニアからは何やってきたか分からないと思っていたので、今までのまとめ的な発表をしました。ネット上を探しても導入時の具体的な話は見つけられなかったので、誰かの参考になることも期待して、外向けも意識しています。Looker ユーザ向けには P30 から「Symmetric 集計」を頑張って解説しています。説明が雑なのは認めます。🙏Looker は学習コストは高いですが、かなりパワフルなツールなので、個人的には非常にやる気を出して燃えています。🔥それでは！","link":"https://developer.feedforce.jp/entry/2020/10/23/190000","isoDate":"2020-10-23T10:00:00.000Z","dateMiliSeconds":1603447200000,"authorName":"masutaka"},{"title":"個人的に実践している、Slack に振り回されない方法","contentSnippet":"こんにちは id:masutaka26 です。足底筋膜炎は誤診のようでした。リハビリに勤しむ日々です。今回は社内向けに書いた esa 記事が好評でしたので、少し改変してお届けします。フィードフォースでは Slack を使っており、リモートワークにおけるコミュニケーションの手段も Slack がメインです。Slack はチャットツールであるため、ある程度のリアルタイム性を求められますが、ただそれに従っていると振り回されてしまいます。今回は私が実践しているいくつかの工夫を紹介します。他に良い方法があれば、是非教えてください。今すぐできないこと（あとでやる＆あとで確認する）は自分にリマインドする自分が他の人に依頼した時もリマインドを設定するチャンネルは優先度を付ける見なくなったチャンネルからはこまめに抜ける未読チャンネルはショートカットキーで移動する今すぐできないこと（あとでやる＆あとで確認する）は自分にリマインドする自分にリマインドすることで忘れることが出来る。同期的コミュニケーションを非同期に逃がす感じ。👇 slackbot からの DM で通知される。すぐ出来なくてさらに先延ばししたければ、Snooze する。出来ない時はゆるふわで良いので Snooze することが大事。放置しないようにしている。👇 たまに slackbot の DM とかで /remind list して確認している。Snooze し忘れたりして、過去のリマインドが残っているとこんな感じになる。→ Past and Incomplete🌀 本当は Gmail の Inbox（受信トレイ）でリマインド管理したい。Snooze が使いやすいし。自分が他の人に依頼した時もリマインドを設定する相手が忘れても大丈夫になる。これも同期コミュニケーションから非同期への変換。チャンネルは優先度を付ける私の場合は Starred \u003e Low Priority \u003e Channels という優先度にしてます。（優先度が分からなくなるので、全未読機能は使っていません）Starred と Channels は最初からあるグルーピングです。Low Priority は自分で作りました。公式ヘルプ: チャンネルやダイレクトメッセージにスターを付ける | Slack💡 Channels の中には mute しているチャンネルもあります。見なくなったチャンネルからはこまめに抜ける抜けたいチャンネルで /leave と発言すると、一瞬で抜けられるよ。未読チャンネルはショートカットキーで移動するWindows前の未読チャンネルや DM に移動: Alt Shift ↑次の未読チャンネルや DM に移動: Alt Shift ↓Mac前の未読チャンネルや DM に移動: Option Shift ↑次の未読チャンネルや DM に移動: Option Shift ↓公式ヘルプ: Slack のキーボードショートカット | Slack","link":"https://developer.feedforce.jp/entry/2020/06/29/140000","isoDate":"2020-06-29T05:00:00.000Z","dateMiliSeconds":1593406800000,"authorName":"masutaka"},{"title":"『HerokuでSidekiqを監視する方法を確立した』という発表をした","contentSnippet":"こんにちは id:masutaka26 です。最近はドラクエウォークと足底筋膜炎との両立に悩んでいます。先週の金曜日、週次の社内勉強会 FFTT で『HerokuでSidekiqを監視する方法を確立した』という発表をしました。Heroku で Sidekiq を監視する知見を見つけられなかったのが、このお題を選んだ経緯です。どなたかが参考になるとうれしいです。今回は自宅からのリモート発表でした。物理発表と違って、話した内容よりもリアクションの分からなさによる戸惑いが気になってしまいました。（オイ※ リアクションはしてくれてたみたいです。🙏複数モニター必須とか、いろいろ知見がありそうなので、今後蓄積出来ると良さそうです。","link":"https://developer.feedforce.jp/entry/2020/03/02/140000","isoDate":"2020-03-02T05:00:00.000Z","dateMiliSeconds":1583125200000,"authorName":"masutaka"},{"title":"Heroku Ruby Language Metrics のメトリクス収集の仕組みを調べた","contentSnippet":"こんにちは。id:masutaka26 です。半年くらい前から Heroku の Ruby Language Metrics (Public Beta) を使い始めました。その時、どのようにメトリクスを収集しているか調べたので、この記事にまとめます。（なぜこのタイミング...）有効にする方法は前述の公式ドキュメントをどうぞ。id:sho7650 の記事も併せて読むと分かりやすいと思います。qiita.comところで、いつから Public Beta だったのですかね？ GA はいつになるのかな...？概要今回は Rails 前提で説明します。このような仕組みでメトリクスの収集と送信が行われます。heroku/metrics buildpack により、Dyno 起動時に agentmon がインストールされ、常駐するRails が起動すると、barnes gem がメトリクスを収集し始め、定期的に localhost の agentmon に送信するagentmon は https://app.metrics.heroku.com/\u003cdyno id\u003e にメトリクスを送信するエンジニアは Heroku Dashboard から Ruby のメトリクスを閲覧できるagentmon のインストールと起動heroku/metrics buildpack によって、agentmon というデーモンがインストールされます。heroku/agentmonagentmon は後述する barnes gem から受け取ったメトリクスを https://app.metrics.heroku.com/\u003cdyno id\u003e に送信します。この URL は環境変数 HEROKU_METRICS_URL の値で、Heroku Dashboard から Enhanced Language Metrics を有効にすると、各 Dyno で定義されます。面白いのは、Slug 生成時には /app/.profile.d/heroku-metrics-daemon.sh がインストールされるだけで、Dyno 起動時にこのスクリプトが実行され、agentmon のインストールと起動が行われることです。Dyno では通常 Puma などのプロセスしか起動されませんが、このような方法を使えばデーモンも起動できることを初めて知りました。ちなみに Dyno が起動する時 /etc/profile によって /app/.profile.d/*.sh がすべて実行されます。barnes gem によるメトリクス収集と送信heroku/barnesRails が起動すると、Barnes.start から呼ばれる Barnes::Periodic.new で Ruby のスレッドが作られます。Barnes.start はすぐに終了しますが、作られたスレッドは非同期で実行されます。無限ループのスレッドなので、Rails が起動している間、起動し続けます。この無限ループでは 10 秒に 1 回、後述するメトリクスを収集し、localhost の agentmon に送信します。送信するのはスレッド中のインスタンス変数 @reporter です。これは Barnes::Reporter のインスタンスで、statsd_client を介して agentmon に送信します。statsd_client は Barnes::Reporter.new 時に渡されます。https://github.com/heroku/barnes/blob/v0.0.8/lib/barnes.rb#L51収集されるメトリクスBarnes::ResourceUsage では収集されるメトリクスを一望できます。https://github.com/heroku/barnes/blob/v0.0.8/lib/barnes/resource_usage.rb#L28-L63収集されるメトリクスと、収集方法です。Puma のメトリクス（ Barnes::Instruments::PumaInstrument ）https://github.com/heroku/barnes/blob/v0.0.8/lib/barnes/instruments/puma_instrument.rb#L33-L48CPU 実行時間等のメトリクス（ Barnes::Instruments::Stopwatch ）https://github.com/heroku/barnes/blob/v0.0.8/lib/barnes/instruments/stopwatch.rb#L36-L58ObjectSpace.count_objects の結果（ Barnes::Instruments::ObjectSpaceCounter ）https://github.com/heroku/barnes/blob/v0.0.8/lib/barnes/instruments/object_space_counter.rb#L27-L30GC.stat の結果（ Barnes::Instruments::RubyGC ）https://github.com/heroku/barnes/blob/v0.0.8/lib/barnes/instruments/ruby_gc.rb#L62-L84まとめHeroku Ruby Language Metrics のメトリクス収集の仕組みを調べました。ただ有効にするだけだと、他のエンジニアに説明することができなかったことが、今回調べた動機です。今回に限りませんが、Heroku は完全なブラックボックスではなく、調べると実装が透けて見えるのがとても良いと思います。","link":"https://developer.feedforce.jp/entry/2020/02/13/150000","isoDate":"2020-02-13T06:00:00.000Z","dateMiliSeconds":1581573600000,"authorName":"masutaka"},{"title":"Heroku Meetup #27 で『デプロイで止まらないバッチ処理を求めて』という話をしてきた #herokujp","contentSnippet":"土曜日にこんにちは id:masutaka26 です。この記事は Heroku Advent Calendar 2019 の 14 日目の記事です。qiita.com昨日は @takahito0508 さんの『Salesforce の Org Development 用の Buildpack を作った話』でした。Heroku の Buildpack は割と簡単な仕組みなので、ハードルが低いですよね。さて、同じ日（2019/12/13）に開催された Heroku Meetup #27 \"Heroku Vitamin!\" で『デプロイで止まらないバッチ処理を求めて』というお題で発表してきました。Heroku meetup は前々回 #25 以来の参加と登壇です。developer.feedforce.jp所感世の中では割と多くのバッチ処理が動いていると思います。ですが、Heroku 上でのバッチ処理はあまり情報がないので、今回紹介させて頂きました。技術スタックとしては、Rails の Active Job と Sidekiq です。今回もニッチな発表ができてとても満足しています。会場にいる一人に刺されば大成功くらいの気持ちで発表していました。中の人曰く、こんな One-Off Dyno の使い方をする人は初めて見たとのこと。(^^;使い方としては問題ないそうですが、Private Spaces では Dyno の起動が遅いそうなので、そこはやや注意とのこと。※ EC Booster では一般向けの Common Runtime を使っています。とは言え、Dyno Create API は Dyno の起動完了を待たずに即座に終了するため、Private Spaces でも大丈夫みたいです。.@masutaka さんのお話 #herokujp pic.twitter.com/RZnLFWq9qn— Satoshi Nagano (@thisisnagano) 2019年12月13日明日は @seijikohara さんです。お楽しみに。","link":"https://developer.feedforce.jp/entry/2019/12/14/153000","isoDate":"2019-12-14T06:30:00.000Z","dateMiliSeconds":1576305000000,"authorName":"masutaka"},{"title":"月末に起動したいバッチを sidekiq-cron で指定し、healthchecks.io で監視する","contentSnippet":"こんにちは。id:masutaka26 です。去年の 6/30 からジムに通い始めて、なんとか週に 2~3 のペースで続いています。サプリメントも半信半疑ながら毎日飲んでいますが、ドラッグストアや Amazon で買うと割と高いと思います。個人的には iHerb がだいぶオススメです。以前 3.6kg のプロテインを買ったらなぜかキャンペーンが適用されて、30% オフの 6,517 円になりました。さらにこの案件動画を見て、プレワークアウトサプリ（C4 SPORT）にも手を出してしまいました。BCAA も飲んでいます。Twitter とかで検索すると、初回 10% OFF の紹介コードが見つかると思います。さらにお得です。何の記事でしたっけ...？そうだ、この記事は Feedforce Advent Calendar 2019 の 5 日目の記事です！昨日は id:kano-e の「2019 年に会社ボドゲ棚から自宅に持ち帰ったボドゲたち」でした。変わらぬボドゲ愛・・・！ff-boardgame.hatenablog.comsidekiq-cron で月末を指定する脈絡ありませんが、sidekiq-cron では last で月末を指定することが出来ます。例えば 0 12 last * * Asia/Tokyo の次回実行は 2019/12/31 12:00 JST です。2019/11/30 12:00 JST は無事動きました。このような設定になります。sample_job:  active_job: true  cron: \"0 12 last * * Asia/Tokyo\"  class: \"SampleJob\"  queue: defaultこの cron 書式は sidekiq-cron が依存する fugit による実装です。確認はしていませんが、last の他にも -1 や L などが使えるようです。🔗 https://github.com/floraison/fugit/blob/v1.3.3/spec/cron_spec.rb#L734-L747context 'negative monthdays' do  [    [ '* * -1 * *', '* * -1 * *' ],    [ '* * -7--1 * *', '* * -7,-6,-5,-4,-3,-2,-1 * *' ],    [ '* * -1--27 * *', '* * -31,-30,-29,-28,-27,-1 * *' ],    [ '* * -7--1/2 * *', '* * -7,-5,-3,-1 * *' ],    [ '* * L * *', '* * -1 * *' ],    [ '* * -7-L * *', '* * -7,-6,-5,-4,-3,-2,-1 * *' ],    [ '* * last * *', '* * -1 * *' ],  ].each { |c, e|    it(\"parses #{c}\") { expect(Fugit::Cron.parse(c).to_cron_s).to eq(e) }  }endnegative monthdays って表現は面白い。healthchecks.io で月末のバッチを監視するバッチが本当に起動したかを監視するのは難しいと思います。月末の監視はさらに難しいと思います。過度な依存は禁物ですが、healthchecks.io は選択肢に入れても良いかもしれません。以下の記事をどうぞ。developer.feedforce.jp前述の cron 設定だと 0 12 l * * で監視することが出来ます。l は小文字のエルです。terraform-provider-healthchecksio の設定例です。resource \"healthchecksio_check\" \"sample_job\" {  name     = \"SampleJob\"  tags     = [\"production\"]  grace    = \"60\"  schedule = \"0 12 l * *\"  timezone = \"Asia/Tokyo\"  channels = [data.healthchecksio_channel.slack.id]}data \"healthchecksio_channel\" \"slack\" {  kind = \"slack\"}こちらの cron 書式は healthchecks が依存する croniter による実装です。l 以外の指定は見当たりませんでした。🔗 https://github.com/taichino/croniter/blob/0.3.29/src/croniter/tests/test_croniter.py#L209-L223def testLastDayOfMonth(self):    base = datetime(2015, 9, 4)    itr = croniter('0 0 l * *', base)    n1 = itr.get_next(datetime)    self.assertEqual(n1.month, 9)    self.assertEqual(n1.day, 30)    n2 = itr.get_next(datetime)    self.assertEqual(n2.month, 10)    self.assertEqual(n2.day, 31)    n3 = itr.get_next(datetime)    self.assertEqual(n3.month, 11)    self.assertEqual(n3.day, 30)    n4 = itr.get_next(datetime)    self.assertEqual(n4.month, 12)    self.assertEqual(n4.day, 31)2019 年もそろそろ終わりです。年末にだけ動くバッチを設定＆監視するのも良いかもしれません。明日は、こばりゅうの記事です。ひこうきかっけー！？お楽しみに。","link":"https://developer.feedforce.jp/entry/2019/12/05/101931","isoDate":"2019-12-05T01:19:31.000Z","dateMiliSeconds":1575508771000,"authorName":"masutaka"},{"title":"Heroku Meetup #25 \"Heroku Ghost\" で 2 回話してきた #herokujp","contentSnippet":"こんにちは id:masutaka26 です。先週金曜日（2019/7/26）に開催された Heroku Meetup #25 \"Heroku Ghost\" で『デプロイ元をCircleCIからHerokuに乗り換えた』というお題で発表してきました。つい先日、現在関わっている EC Booster のデプロイフローを改善し、それなりに知見を得られたためです。Heroku Meetup の参加は前回 #24 に引き続き、セッションでの発表は前々回 #23 以来です。前々回 #23 については自分のブログにも書きました。Heroku Meetup #23 \"Heroku Dynamite!!\" で話してきた #herokujp / マスタカの ChangeLog メモLT でも話したLT でも飛び込みで話しました。内容は heroku-buildpack-google-chrome と heroku-buildpack-chromedriver の細かすぎる話です。動かない Chrome や chromedriver のバイナリが本番環境にデプロイされることを防ぐ方法や、それに関して PR を出した話など。スライドの 41~43 ページ目が相当します。無駄に元気な 1 日でした。今日は会社で LT 1 本やって、Heroku meetup で通常セッション 1 本、その後に飛び込み（？）で LT 1 本やった。さすがにもうこの数をやることないかな？ #herokujp— Takashi MASUDA (@masutaka) 2019年7月26日※ 44~45 ページ目は、尺の関係で削ったブランチ戦略のメモです。ベストな戦略ではないので改善予定。雑感初心者向けの知見に比べて、一歩進んだ Heroku 知見はあまり Web 上に存在しない印象です。ここ 1 年近く、それなりに Heroku を学習してきて「かなりの規模まで Heroku で十分では？」「デプロイや Dyno の再起動で中断されるため苦手とされがちなバッチ処理も、簡単に克服できるのでは？」などと、考えが変わってきています。これからもブログや登壇などで、コミュニティに還元していきます。本日の頂き物。キャップはスピーカー特典 #herokujp pic.twitter.com/Whc3UVJrbg— Takashi MASUDA (@masutaka) 2019年7月26日","link":"https://developer.feedforce.jp/entry/2019/07/29/140000","isoDate":"2019-07-29T05:00:00.000Z","dateMiliSeconds":1564376400000,"authorName":"masutaka"},{"title":"esa をネタに Emacs Lisp と Elm を無理やり繋げた発表をした","contentSnippet":"こんにちは。増田（id:masutaka26）です。今回はネタ探しに特に苦労しました。週次の社内勉強会 FFTT で『esaを支えたい技術』という発表をしました。esa をネタに Emacs Lisp と Elm を無理やり繋げた内容です。ちょっと強引だった。発表の内容流れとしては、↓ こんな感じです。先月 emacs-helm-esa というツールを作ったよElm を学んだら、Emacs Lisp と Syntax が似ていたよesa の検索をするだけの簡単なツールを作ったよ発表の感想付箋紙に感想を書いてくれました。 は私からのコメントです。関数型言語について学んでみたいと思っていたので、おすすめの順序を提示してくださり、参考になりました！ 良かったです。Elm はだいぶ学びやすかったですElm、こうして見てみると Haskell にめっちゃ似てますね！ そうなんですね発表の流れで Elm の話になると思わなかった 強引でしたね (^^;Elm ならふだんバックエンドのコード書いている人でもモダンなフロントエンド書けるって聞いたので勉強がんばる（決意） 刺激になってよかったです良かったです！規模が大きくなってきても同じノリで書けるのも Elm は良い そういう感じなんですね。コンパイルが通ればだいたい動くのが楽でしたElm の HTML を作るのがすごいですね！ ですよね。この辺りの div や i は全部関数ですからねネタバレに慎重になりすぎでは！？ 自分でも全く理解できません来週にはこれが Chrome 拡張になっているんですかね？ はい、次回以降の当番の方が必ず・・・！Elm おもしろそう 🏃‍♀️🚶‍♂️ emacs ってすごいんですね とは言え、今の時代は emacs の他に優先順位の高いものがたくさんありますね 💦まさかの Elm とは！？ 考えに考えた末の Elm です...これで EC Booster Front 開発できますね 見ててくださいよ！これからのマスタカを！！１所感正直、外したかな？と思いながら発表してましたが、感想を読むと良い刺激を与えられたようで良かったです。一方で新しい言語の説明は難しいうえ、皆さんに馴染みがない Emacs Lisp との比較をしたので、余計に分かりづらかったという...。こうするとあまり盛り上がらないという学びを得たことと、個人的には大変満足のいく内容だったので、結果的には良かったです。さて、次回の勉強会のネタはどうするかな...。基礎からわかる Elm作者:鳥居 陽介発売日: 2019/02/27メディア: 単行本（ソフトカバー）","link":"https://developer.feedforce.jp/entry/2019/07/01/140000","isoDate":"2019-07-01T05:00:00.000Z","dateMiliSeconds":1561957200000,"authorName":"masutaka"},{"title":"Heroku で Chrome を使ったクローラの IP アドレスを固定する","contentSnippet":"こんにちは id:masutaka26 です。少し前に、Heroku の worker Dyno 上で動く、Chrome のクローラで IP アドレスを固定化出来ないか調査しました。実装は見送られましたが、想定よりも難しく調査に時間がかかったので、この記事に残しておきます。方法だけ知りたい方は、下の方にある「手順」をご覧ください。Heroku Add-on を比較する開発組織実装プランCLI のインストールHeroku Buildpack[コラム] 固定 IP アドレスへの私見Chrome のクローラで IP アドレスを固定化する試行錯誤の日々ついに成功手順QuotaGuard Static の注意事項まとめHeroku Add-on を比較する今回は Proximo と QuotaGuard Static を検討し、最終的に QuotaGuard Static を採用しました。💡 他に Fixie, Fixie Socks, Guru301 などがあるようです。以下、その理由です。開発組織Proximo は https://github.com/pirateradio を見た感じ @ddollar の個人開発のようです。この方は foreman などを作っており、多分すごい人です。QuotaGuard Static は https://www.quotaguard.com/ によると Alpine Shark, LLC のようです。会社のほうがちょっとだけ安心できます。実装Proximo は 1 つのようですが、QuotaGuard Static は 2 つの Proxy サーバで冗長化されているようです。Proxy サーバが落ちる確率は低いかもしれませんが、冗長化されているに越したことはありません。🔗 https://devcenter.heroku.com/articles/proximo#provisioning-the-proximo-add-on$ heroku addons:create proximo:developmentAdding proximo to sharp-mountain-4005... done, v18 ($5/mo)Your static IP address is 10.9.8.7🔗 https://devcenter.heroku.com/articles/quotaguardstatic#provisioning-the-add-on$ heroku addons:create quotaguardstatic:starter-----\u003e Adding quotaguardstatic:starter to sharp-mountain-4005... done, v18 (free)-----\u003e Your static IPs are [10.11.12.13, 14.15.16.17]プランQuotaGuard Static は無料プランがあるので始めやすいです。Proximo のプランは $5/mo からです。ちなみにどちらも PROXIMO_MASK や QUOTAGUARDSTATIC_MASK という環境変数を設定すると、一部のレンジの送信だけこれらのサービス経由にすることができ、料金を節約できます。💡 正確に書くと QUOTAGUARDSTATIC_MASK は後述する qgsocksify 用の環境変数です。CLI のインストールどちらも CLI が提供されており、必要に応じてインストールします。Proximo はインストール元が http なのがイマイチでした。https に変えてもアクセス不可です。$ curl http://downloads.proximo.io/proximo-stacklet.tgz | tar xzQuotaGuard Static は普通に https でインストール出来ます。$ curl https://s3.amazonaws.com/quotaguard/qgtunnel-latest.tar.gz | tar xz$ curl https://s3.amazonaws.com/quotaguard/quotaguard-socksify-latest.tar.gz | tar xzHeroku Buildpack今回の調査の過程で Heroku Buildpack を作りました。バイナリファイルをリポジトリに commit せずに済みます。よかったらどうぞ。https://github.com/masutaka/heroku-buildpack-proximohttps://github.com/masutaka/heroku-buildpack-qgtunnelhttps://github.com/masutaka/heroku-buildpack-qgsocksify[コラム] 固定 IP アドレスへの私見IP アドレスを固定化したいのは、どんなケースでしょうか。多くはセキュリティ要件だと思いますが、私はあまり賛同できないです。そもそも当該 IP アドレスは認証されておらず、所有者が変わることがあります。仕組み上それに気づくことは難しいため、逆にセキュリティリスクを増やすことになります。そういう意味では電話番号とよく似ています。サービスのスケールの観点からもデメリットがあります。例えば Heroku から AWS に引っ越す時、固定 IP アドレスは変わってしまうでしょう。顧客との調整が必要ですし、間に開発会社が入っていると、より時間がかかります。Chrome のクローラで IP アドレスを固定化する今回のケースでは Heroku の worker Dyno 上に sidekiq が起動しており、selenium-webdriver 経由で Chrome が子プロセスとして起動し、クロールします。sidekiq└ Chrome   ↓   クロール先試行錯誤の日々当初は sidekiq 自体に qgtunnel や qgsocksify をラップしましたが、うまくいきませんでした。よく考えたら納得です。Chrome に --proxy-server=http://\u003cUSERNAME\u003e:\u003cPASSWORD\u003e@\u003cHOSTNAME\u003e:\u003cPORT\u003e や --proxy-auth=\u003cUSERNAME\u003e:\u003cPASSWORD\u003e を指定してもダメ。どうやら少なくとも Chrome 73 ではセキュリティ上の理由から、コマンドラインオプションから認証情報を設定できないようです。認証なしプロクシなら大丈夫ですが、QuotaGuard Static は商用サービスなので認証は必須です。ついに成功ダメ元で QuotaGuard Static のサポートに聞いたら、方法を知っており、無事クロール先にアクセスすることが出来ました。👇 Dyno とクロール先を SOCKS5 トンネルで繋ぎ、それ経由でアクセスします。sidekiq└ Chrome (4443 port)   ↓ (SOCKS5 tunnel)   QuotaGuard Static   ↓ (SOCKS5 tunnel)   クロール先 (443 port)TCP アクセスならなんでも IP アドレスを固定化出来そうです。手順(1) 当該 Heroku App に QuotaGuard Static Add-on をインストールします。(2) qgtunnel CLI もインストールします。前述の heroku-buildpack-qgtunnel を使うとお手軽です。$ curl https://s3.amazonaws.com/quotaguard/qgtunnel-latest.tar.gz | tar xz(3) Heroku のダッシュボードから、QuotaGuard Static のダッシュボードに進み、Settings → Setup とクリックします。(4) さらに Tunnel → Create Tunnel とクリックします。(5) Remote Destination にクロール先を、Local Port は 4443、Transparent は true に設定します。Encrypted は設定しません。(6) トンネルが出来ました。127.0.0.1:4443 へのアクセスは destination.example.com:443 へのトンネルになりますTransparent を有効したことにより、destination.example.com の DNS が 127.0.0.1 に上書きされました。destination.example.com:4443 へのアクセスは destination.example.com:443 と等価になりますすでに HTTPS を使っているため、Encrypted は必要ありません(7) selenium-webdriver に与える Chrome のバイナリを qgtunnel でラッピングします。今回は以下のようなシェルスクリプト bin/google-chrome-qgtunnel を作り、selenium-webdriver に指定しました。#!/bin/sh -euexec bin/qgtunnel \"$GOOGLE_CHROME_SHIM\" \"$@\"💡 heroku-buildpack-google-chrome と heroku-buildpack-chromedriver を使っています。環境変数 GOOGLE_CHROME_SHIM は /app/.apt/usr/bin/google-chrome です。(8) 左側の Outbound をクリックし、SOCKS5 url を Heroku の環境変数 QUOTAGUARDSTATIC_URL に上書きします。(9) 左側の Tunnel から Download Configuration をクリックし、.qgtunnel ファイルをリポジトリに commit します。(10) 以上の設定により、destination.example.com:4443 へのアクセスが destination.example.com:443 に変換され、且つ IP アドレスも固定されます。なにかトラブルがあったら Heroku の環境変数 QGTUNNEL_DEBUG に true をセットして、ログを確認すると良いと思います。QuotaGuard Static の注意事項app.json の addons に quotaguardstatic を追加して、Review App を作ると Micro plan $19/mo で作られてしまいます。quotaguardstatic:starter とかにしても同じです。QuotaGuard Static のサポートに聞いたところ、Heroku のアカウント単位で設定を変える必要があるそう。問い合わせが必要です。まとめHeroku の worker Dyno 上で動く、Chrome のクローラで IP アドレスを固定化しました。固定 IP アドレス対応は出来るだけ避けたほうが良いと思いますが、どうしても必要な時にこの記事が参考になれば幸いです。","link":"https://developer.feedforce.jp/entry/2019/04/26/154540","isoDate":"2019-04-26T06:45:40.000Z","dateMiliSeconds":1556261140000,"authorName":"masutaka"},{"title":"Heroku の Preboot 機能を深掘りした","contentSnippet":"こんにちは id:masutaka26 です。この記事は Heroku Advent Calendar 2018 の 12 日目の記事です。qiita.com昨日は @takuchalle さんの『Heroku で wkhtmltoimage を使う方法』でした。似たツールの webkit2png は使ったことがあります。webkit2png が動作するのは macOS だけですが、wkhtmltoimage は Windows と Linux でも動作するのですね。へぇー。先月、Heroku の Preboot 機能を調べる機会がありました。Web 上の日本語記事は Preboot が GA になった 2014 年頃の情報が多く、若干情報が古かったため、2018 年時点の最新の情報をまとめます。Preboot 機能とは何かどのように有効にするのか使用する Procfileデプロイによる heroku ps の変化デプロイ時の挙動デプロイ時のログ再起動時の挙動再起動時のログWeb dyno 1 台目Web dyno 2 台目注意事項まとめPreboot 機能とは何かProduction Check \u003e Dyno redundancy に書いてあるとおり、Heroku では冗長性確保のため、本番環境の Web Dyno は 2 台以上が奨励されています。Running at least 2 web dynos for any mission-critical app increases the probability that the app will remain available during a catastrophic event. Multiple dynos are also more likely to run on different physical infrastructure (for example, separate AWS Availability Zones), further increasing redundancy.ただし、それだけだとデプロイや 1 日 1 回の自動再起動で、処理の遅延（H27 - Client Request Interrupted）や H28 - Client Connection Idle が発生することがあります。以下のグラフは Dyno Restart のタイミングで H27 と H28 Error が発生している様子です。このグラフはダッシュボードの Metrics から確認できます。これを回避できるのが Preboot 機能です。どのように有効にするのかHeroku CLI で有効にできます。$ heroku features:enable preboot -a YOUR_APP_NAME有効になりました。簡単ですね。$ heroku features:info preboot -a YOUR_APP_NAME=== prebootDescription: Provide seamless web dyno deploys [general]Docs:        https://devcenter.heroku.com/articles/prebootEnabled:     true使用する Procfile今回はこの Procfile を使います。release: bin/rails db:migrate db:seed# Web appweb: bin/rails s -p $PORT -e $RAILS_ENVworker: PROCESS_TYPE=worker bundle exec sidekiq -C config/sidekiq.yml# Ad appad_worker: PROCESS_TYPE=ad_worker bundle exec sidekiq -C config/sidekiq.ymlweb, worker, ad_worker という 3 つの process type を定義しています。今回注目する process type は web だけです。1 行目で release も定義しているため、デプロイ時には One-Off Dyno1 で release 処理をしたあと、生成した Slug が Dyno に展開されていきます。デプロイによる heroku ps の変化それでは $ watch 'heroku ps -a YOUR_APP_NAME' しつつ、デプロイの様子を観察していきましょう。macOS では watch コマンドは $ brew install watch 等でインストール出来ます。Web Dyno 1 台の場合、release Dyno の実行が終わると、web.1 Dyno のステータスが up → starting → up と変化します。starting 中にリクエストがあると、クライアントは待たされ、前述の H27 や H28 Error が発生します。Web Dyno 1 台でデプロイした様子Web Dyno 2 台かつ Preboot 無効でも、基本的に同じです。2 台同時に up → starting → up と変化します。Web Dyno 2 台かつ Preboot 無効でデプロイした様子Web Dyno 2 台かつ Preboot を有効にすると、期待した通り、1 台ずつ up → starting → up になりませんでした・・・！あれ？Web Dyno 2 台かつ Preboot 有効でデプロイした様子Logs will show new dynos starting soon after the slug compile is finished. The output of heroku ps will immediately show the state (for example, starting or up) of the new dynos. Old dynos are still running but won’t appear in heroku ps.Preboot のドキュメントによると、heroku ps では確認できないようです。ただしログでは確認できるそう。デプロイ時の挙動Approximately 3 minutes after the deploy completes (or 2 minutes after your app’s boot timeout limit, which defaults to 1 minute), HTTP requests will start routing to the new dynos and simultaneously stop routing to the old dynos.遅くともデプロイ完了から約 3 分後、もしくはアプリケーションの起動タイムアウトリミット 2 分（デフォルトは 1 分）後、HTTP リクエストは新 Dyno に Routing されるそうです。Shortly after the new dynos are fully live and serving user requests, the old dynos will be shut down. You’ll see them shut down in the logs as usual.新 Dyno が完全に起動し、ユーザリクエストを処理するとすぐに、旧 Dyno はシャットダウンされるようです。これもログで確認可能とのこと。では実際にログを見てみましょう。デプロイ時のログgit push 後まもなく、Web dyno の状態が up から starting に変わりました。Nov 28 14:58:51 heroku[web] notice RestartingNov 28 14:58:51 heroku[web] notice State changed from up to startingNov 28 14:58:51 heroku[web] notice RestartingNov 28 14:58:51 heroku[web] notice State changed from up to starting新 Web dyno 2 台で Puma (Web server) がそれぞれ起動を開始しました。Nov 28 14:59:17 heroku[web] notice Starting process with command `bin/rails s -p 24256 -e production`Nov 28 14:59:19 heroku[web] notice Starting process with command `bin/rails s -p 15417 -e production`Nov 28 14:59:21 app[web] info [heroku-exec] StartingNov 28 14:59:22 app[web] info [heroku-exec] StartingNov 28 14:59:31 app[web] info =\u003e Booting PumaNov 28 14:59:31 app[web] info =\u003e Rails 5.2.1 application starting in productionNov 28 14:59:31 app[web] info =\u003e Run `rails server -h` for more startup optionsNov 28 14:59:32 app[web] info =\u003e Booting PumaNov 28 14:59:32 app[web] info =\u003e Rails 5.2.1 application starting in productionNov 28 14:59:32 app[web] info =\u003e Run `rails server -h` for more startup optionsWeb dyno の状態が starting から up に変わりました。まだ Puma は起動しきっていません。Nov 28 14:59:33 heroku[web] notice State changed from starting to upNov 28 14:59:34 heroku[web] notice State changed from starting to up新 Web dyno 1 台で Puma が起動しきりました。問題はありませんが、手元で起動するよりずいぶん遅い気がします。Nov 28 15:02:03 app[web] info Puma starting in single mode...Nov 28 15:02:03 app[web] info * Version 3.12.0 (ruby 2.5.3-p105), codename: Llamas in PajamasNov 28 15:02:03 app[web] info * Min threads: 11, max threads: 11Nov 28 15:02:03 app[web] info * Environment: productionNov 28 15:02:03 app[web] info * Listening on tcp://0.0.0.0:24256Nov 28 15:02:03 app[web] info Use Ctrl-C to stop旧 Web dyno 1 台で Puma が終了しました。前述の意訳では約 3 分とあるため合っています。Nov 28 15:02:19 heroku[web] notice Stopping all processes with SIGTERMNov 28 15:02:19 app[web] info Gracefully stopping, waiting for requests to finishNov 28 15:02:19 app[web] info === puma shutdown: 2018-11-28 06:02:19 +0000 ===Nov 28 15:02:19 app[web] info Goodbye!Nov 28 15:02:19 app[web] info ExitingNov 28 15:02:19 heroku[web] notice Process exited with status 143もうひとつの旧 Web dyno 1 台で Puma が終了しました。これも意訳のとおりです。Nov 28 15:03:25 heroku[web] notice Stopping all processes with SIGTERMNov 28 15:03:25 app[web] info Gracefully stopping, waiting for requests to finishNov 28 15:03:25 app[web] info === puma shutdown: 2018-11-28 06:03:25 +0000 ===Nov 28 15:03:25 app[web] info Goodbye!Nov 28 15:03:25 app[web] info ExitingNov 28 15:03:25 heroku[web] notice Process exited with status 143もうひとつの新 Web dyno 1 台で Puma が起動しきりました。Booting Puma からずいぶんと時間がかかりました。Nov 28 15:05:08 app[web] info Puma starting in single mode...Nov 28 15:05:08 app[web] info * Version 3.12.0 (ruby 2.5.3-p105), codename: Llamas in PajamasNov 28 15:05:08 app[web] info * Min threads: 11, max threads: 11Nov 28 15:05:08 app[web] info * Environment: productionNov 28 15:05:08 app[web] info * Listening on tcp://0.0.0.0:15417Nov 28 15:05:08 app[web] info Use Ctrl-C to stopPuma の起動に時間がかかるのは謎ですが、Preboot のドキュメントと相違ないと理解しました。再起動時の挙動再起動時の挙動も確認します。Heroku ではアプリケーションの健全性を維持するため、Dyno は 1 日に 1 回、自動的に再起動します。Dyno は差し替えられるため、ローカルファイルシステムの変更はすべて破棄されます。The new dynos will start receiving requests as soon as it binds to its assigned port. At this point, both the old and new dynos are receiving requests.新 Dyno は割り当てられたポートにバインドされると、すぐにリクエストを受信し始めます。この時点で、新旧の Dyno がリクエストを受信するそう。Approximately 4 to 6 minutes after the restart is invoked, the old dynos will be shut down. You’ll see them shut down in the logs as usual.再起動が行われてから、約 4~6 分後に旧 Dyno がシャットダウンされるようです。これもログで確認可能とのこと。Preboot が GA になった 2014 年頃は、まだ 1 日 1 回の再起動には対応していないようでした。現在は対応しているようです。再起動時のログ結論から書くと、1 台目が再起動し終えてから 2 台目が再起動していました。再起動においても、ドキュメントの通りに Preboot が機能しているようです。Web dyno 1 台目Web dyno 1 台の状態が up から starting に変わりました。Nov 30 11:41:22 heroku[web] notice CyclingNov 30 11:41:22 heroku[web] notice State changed from up to starting新 Web dyno 1 台で Puma が起動を開始しました。Nov 30 11:41:42 heroku[web] notice Starting process with command `bin/rails s -p 32434 -e production`Nov 30 11:41:44 app[web] info [heroku-exec] StartingNov 30 11:41:50 app[web] info =\u003e Booting PumaNov 30 11:41:50 app[web] info =\u003e Rails 5.2.1.1 application starting in productionNov 30 11:41:50 app[web] info =\u003e Run `rails server -h` for more startup optionsWeb dyno 1 台の状態が starting から up に変わりました。まだ Puma は起動しきっていません。Nov 30 11:41:51 heroku[web] notice State changed from starting to up新 Web dyno 1 台で Puma が起動しきりました。相変わらず時間がかかります。Nov 30 11:45:45 app[web] info Puma starting in single mode...Nov 30 11:45:45 app[web] info * Version 3.12.0 (ruby 2.5.3-p105), codename: Llamas in PajamasNov 30 11:45:45 app[web] info * Min threads: 11, max threads: 11Nov 30 11:45:45 app[web] info * Environment: productionNov 30 11:45:45 app[web] info * Listening on tcp://0.0.0.0:32434Nov 30 11:45:45 app[web] info Use Ctrl-C to stop旧 Web dyno 1 台で Puma が終了しました。前述の意訳では約 4~6 分後とありましたが、間を置かずに終了しました。Nov 30 11:45:55 heroku[web] notice Stopping all processes with SIGTERMNov 30 11:45:56 app[web] info Gracefully stopping, waiting for requests to finishNov 30 11:45:56 app[web] info === puma shutdown: 2018-11-30 02:45:55 +0000 ===Nov 30 11:45:56 app[web] info Goodbye!Nov 30 11:45:56 app[web] info ExitingNov 30 11:45:56 heroku[web] notice Process exited with status 143Web dyno 2 台目もうひとつの Web dyno 1 台の状態が up から starting に変わりました。14 分くらい差があります。最大 216 分のランダムな差があるようなので、記載通りです。Nov 30 12:00:41 heroku[web] notice CyclingNov 30 12:00:41 heroku[web] notice State changed from up to starting新 Web dyno 1 台で Puma が起動を開始しました。Nov 30 12:00:59 heroku[web] notice Starting process with command `bin/rails s -p 16965 -e production`Nov 30 12:01:01 app[web] info [heroku-exec] StartingNov 30 12:01:08 app[web] info =\u003e Booting PumaNov 30 12:01:08 app[web] info =\u003e Rails 5.2.1.1 application starting in productionNov 30 12:01:08 app[web] info =\u003e Run `rails server -h` for more startup optionsWeb dyno 1 台の状態が starting から up に変わりました。まだ Puma は起動しきっていません。Nov 30 12:01:10 heroku[web] notice State changed from starting to up新 Web dyno 1 台で Puma が起動しきりました。今回は時間がかかりませんでした。Nov 30 12:01:15 app[web] info Puma starting in single mode...Nov 30 12:01:15 app[web] info * Version 3.12.0 (ruby 2.5.3-p105), codename: Llamas in PajamasNov 30 12:01:15 app[web] info * Min threads: 11, max threads: 11Nov 30 12:01:15 app[web] info * Environment: productionNov 30 12:01:15 app[web] info * Listening on tcp://0.0.0.0:16965Nov 30 12:01:15 app[web] info Use Ctrl-C to stop旧 Web dyno 1 台で Puma が終了しました。今度は時間がかかりました。前述の意訳では約 4~6 分後とあるため合っています。Nov 30 12:05:14 heroku[web] notice Stopping all processes with SIGTERMNov 30 12:05:14 app[web] info Gracefully stopping, waiting for requests to finishNov 30 12:05:14 app[web] info === puma shutdown: 2018-11-30 03:05:14 +0000 ===Nov 30 12:05:14 app[web] info Goodbye!Nov 30 12:05:14 app[web] info ExitingNov 30 12:05:14 heroku[web] notice Process exited with status 143注意事項Preboot を有効にしてデプロイすると、無効時よりも時間をかけて Dyno が差し替わります。全ての Dyno に反映されるまで数分かかることもあるようです。この点はチームで把握しておく必要があります。最大 3 分間、新旧の Dyno が重複するため、Add-on の同時接続数の制限に達する可能性があります。Heroku Postgres の場合は pgbouncer buildpack を使うことが奨励されています。新旧の Dyno が混在することにより、一度のデプロイで DB schema とアプリケーションコードを変更すると、不具合が発生する可能性があります。Preboot 機能を一旦無効にすることを勧めています。でも、Procfile に release process type を定義していれば同じなので、個人的には気にならないですね。Preboot 機能を使うためには、Dyno type が Standard-1X 以上である必要があります。Dyno type が Free と Hobby では Preboot を有効に出来ません。Preboot が適用されるのは Web Dyno だけです。自分で定義した worker Dyno 等は対象外です。まとめHeroku の Preboot 機能を深掘りし、有効にする必要性を理解しました。Web Dyno を 2 台以上にしたら Preboot を有効にすると良さそう前述の「注意事項」には留意したほうが良いしかし、こんなに長い記事になるとは...。明日の heroku Advent Calendar 2018 はまたまた id:masutaka26 です。Bitbar の便利な Heroku plugin を紹介してくれるみたいです。お楽しみに。このような使い捨ての Dyno を One-Off Dyno と呼びます。heroku run で使われる Dyno もそうです。↩","link":"https://developer.feedforce.jp/entry/2018/12/12/120000","isoDate":"2018-12-12T03:00:00.000Z","dateMiliSeconds":1544583600000,"authorName":"masutaka"},{"title":"『Heroku と EC Booster と私』と『Heroku ちょこっと Deep Dive』という発表をした","contentSnippet":"こんにちは。増田（id:masutaka26）です。以前住んだ街を訪れるのが趣味です。週次の社内勉強会 FFTT で『Heroku と EC Booster と私』と『Heroku ちょこっと Deep Dive』という発表をしました。まさかのダブルタイトル・・・！ スライドを作っていたら別々の話のような気がして、こうなりました。発表の内容『Heroku と EC Booster と私』は主に社内向けの話です。最近の EC Booster のインフラを紹介する機会がなかったので、今回の発表の場を借りました。『Heroku ちょこっと Deep Dive』では Heroku の Slug について、ちょこっと調べました。Heroku では Dyno という軽量コンテナ上で、アプリケーションが動作します。アプリケーションは Slug というパッケージに固められています。Slug にはアプリケーションコードの他に Buildpack や、Ruby なら bundle install されたライブラリ等が含められています。最近 Heroku を Terraform で管理し始めた時に、heroku_slug というリソースを見つけました。使いはしなかったのですが、自分で Slug を変更できる感覚がよく分からなくて調べたことが始まりでした。まさか Scratch から作れるとは思いませんでしたし、Slug の中身やサイズの増減を把握する方法が分かったことは大きな収穫でした。発表では話し忘れたのですが、Heroku は Stack に日々セキュリティパッチが当たって、24 時間以内に適用されることは大きなメリットです。小さなチームで当てるべきパッチの把握や適用をするのは、相当しんどいですからね。それでは、発表後に書いてくれた付箋への返信です。発表の感想付箋紙に感想を書いてくれました。 は私からのコメントです。 いつもありがとうございますふだん Heroku Review App しか使ってなかったんですが、興味を持ちました Rails アプリの公開にも、小さなスクリプトの定期実行にも使えるので便利ですよマッスル マスタカ！💪 マッスル マッスル！💪Heroku 未だに HTTP 1.1 なんですよね そうなんですよねー 💦 さすがにそろそろ...早く AWS + CloudFront 使いたい assets は CDN に逃したいですねー(dfplus.)io はいまだにフロントは Heroku 使ってマスタカ そうでありマスタカPush された tar ball に build された file が入るんですか そんな感じですーEC Booster のリリース時に Heroku を徹底的につかいたおすことを目標にしていたので、この発表もマスタカさんのふだんの仕事もとても感謝しています もったいないお言葉、ありがとうございます！「Heroku は良いサービス」めっちゃわかる だよねーHeroku は良しなにやってくれるけど、その「良しなに」部分もちゃんとオープンになっているのすばらしい ですねー。ずっと謎だった Slug の正体が分かってよかったですプロダクション環境での Heroku 運用、勉強になりました まだまだ小さなサービスですからね。これから大きくなると、問題がたくさん出てきそうですなんか push したら動かしてくれる Heroku が裏で何やってるか知れてよかったです！ 最近便利な機能知って Heroku いいなーってなってます！ ありがとうございます。他にも Heroku CI や Promoting など、まだ試せていない機能がありますねー資料が分かりやすいです 安心安全な資料作りを心がけて参ります資料の文字数がちょうど良くてとても見やすいと思いました 本当はもっと減らしたいのですが、あとから読める資料としても作ったので、今回の長さになりましたボトルネックがないようなら Heroku 便利そう とは言え、パフォーマンスを突き詰めると厳しいと感じています。現在は割とバックグラウンド＆バッチ処理にフォーカスしていますさすが弊社で Heroku に一番詳しい男！！ 引き続きニッチな領域を攻めていきますマスタカさんは説明が上手だなと思いました（こなみ） ありがとうございます！Heroku..... なんだかんだ、難しいイメージがあります... 私も最初はそうでしたねー身近に仕事で Heroku 使ってる人だー いえす！初心者でも使えるけど奥が深い Heroku ですねー発表の感想の感想Heroku はバックエンドエンジニアには概ね好評ですが、フロントエンドエンジニアには割と不評な印象を受けました。HTTP/3 という話が出てきた今、未だに HTTP/1.1 なのはだいぶ遅れてますし、パフォーマンスを突き詰めると、どうしてもレイテンシー問題に直面してしまいます。逆に言えば、この辺どうにかなれば最強だと思うのですが。🌀Heroku の先を見据えてやっていきます。💪","link":"https://developer.feedforce.jp/entry/2018/11/14/140000","isoDate":"2018-11-14T05:00:00.000Z","dateMiliSeconds":1542171600000,"authorName":"masutaka"},{"title":"terraform-provider-healthchecksio に足りない機能を実装したらコラボレータになれた","contentSnippet":"こんにちは、増田（id:masutaka26）です。秋は体が急に冷え、一年で一番体調を崩しやすいので、意識して風呂に浸かっています。元気です。id:critical_alert から https://healthchecks.io/ を教えてもらいました。cron 系の定期実行ジョブが本当に実行されたかを監視してくれるサービスです。以前、sidekiq-cron のバグで定期実行ジョブが実行されないことがあったので、なんらかの方法でお手軽に監視したいモチベーションがありました。terraform-provider-healthchecksio を発見コード化したいなーと思って調べたら、非公式の Terraform provider を発見。kristofferahl/terraform-provider-healthchecksioこういった設定は属人化しやすいため、Terraform でコード化できるのは助かります。ただ、この時点では schedule や timezone などに対応していなかったため、採用は断念しました。healthchecks.io 上でポチポチと監視用のエンドポイントを作成し、ビジネスロジックにも ping するコードを埋め込み、いい感じに動作していました。実装開始悶々とした日を送り続けたある日、調べてみたら意外と簡単に機能が実装できそうなことが分かりました。👇 それで送ったのがこの PR。可能な限りのパラメータを使えるようになりました。Add parameters by masutaka · Pull Request #1terraform import もしたいなーと調べたら、たったの 3 行で対応出来ることが判明。👇 2 つ目の PR を出して無事マージされました。Introduce terraform import by masutaka · Pull Request #2ついでにしれっとコラボレータに招待してくれて、commit 権を頂けました。やったぜ！👇 先ほど 3 つ目の PR を出しました。非公式の Terraform provider なので、自分でバイナリを設置する必要があるのですよね。参考になりそうな Makefile を作りました。Add examples/Makefile by masutaka · Pull Request #3今後の予定The database failover process is manual, and the ops team consists of a single person, so multi-hour or even multi-day outages are possible!While we can only guarantee a best effort availability, in practice the availability has exceeded 99.9% since the service publicly launched in July 2015.https://healthchecks.io/about/healthchecks.io は安定稼働しており、2015 年 7 月のサービス開始以来、稼働率は 99.9% を超えているそうです。ただあくまでベストエフォート型の可用性しか保証していないので、過信は禁物です。いわゆる 1 人開発プロジェクトでもあります。今後は Datadog で同じ監視が出来るか調査して、healthchecks.io と併用したいなーと思っています。Cronitor も頭の片隅にあるけど、少しオーバースペック感があります。おまけhealthchecks.io は OSS でもあり、GitHub 上にコードが公開されています。Django で実装されています。healthchecks/healthchecks","link":"https://developer.feedforce.jp/entry/2018/10/09/140000","isoDate":"2018-10-09T05:00:00.000Z","dateMiliSeconds":1539061200000,"authorName":"masutaka"},{"title":"先期の MVP に選ばれた","contentSnippet":"お元気にしてますか。増田（id:masutaka26）です。先週の金曜日にフィードフォースにおける 2017 年度（2017年6月 〜 2018年5月）の納会が行われ、その中で初の MVP を受賞することができました。🎉喜びのコメントを表明中のしがないますたかチーム賞ももらったヨ会社で賞を頂いたのは 4 年前のルーキー賞以来です。masutaka.net四年寝太郎としては、取るべくして取った賞だと思いました（ｷﾘｯ正直なところ、頑張ったで賞くらいはもらえたりして？とボンヤリ思っていましたが*1、まさか MVP とは思いもよらず、発表の瞬間は素で驚きました。2017 年度は以下のチームに所属していました。2017 年 6 月 〜 2018 年 3 月DF PLUS（社内では DF Maker と呼ばれる）2018 年 4 月 〜 2018 年 5 月EC BoosterDF Maker ではサービスの信頼性向上にひたすら努める毎日でした。ECS でとんでもない量のエラーが発生して、３連休の間は暇を見つけてエラーログを確認してたなー（遠い目）。EC Booster ではチームビルディングから始めました。👇️以下の記事にまとまっています。developer.feedforce.jpどちらにも共通することが、2 年目の優秀な若者と仕事ができたことです。私が若者を引っ張っていくぜーという感じではなくむしろ逆で、すでにサービスを知り尽くした若者から学ぶ日々でした（今もそうです）。その中で、「こうすればチーム開発がドライブするだろう」や「こうすればサービスの質を高められるだろう」というアイディアを出し、実践し、小さな改善と失敗を繰り返したことが、結果としてチームの状況を良くしたりサービスの質を高めることが出来たのだと思います（現在進行系）。もちろん、一緒に働くことができたチームの皆さんの協力があっての賞です。ありがとうございます。🙏それではまた 4 年後にお会いしましょう💤*1:そのような賞はありません","link":"https://developer.feedforce.jp/entry/2018/06/15/130000","isoDate":"2018-06-15T04:00:00.000Z","dateMiliSeconds":1529035200000,"authorName":"masutaka"},{"title":"『開発基盤チームとして課題を探したらマネジメントをしていた』という発表をした","contentSnippet":"こんにちは。増田（id:masutaka26）です。発表が無事終わり、何かゲームでも買おうかなと思ってます。さて、フィードフォースでは毎週金曜日 16:00 から、社内技術勉強会を開催しています。当番制の持ち回りで技術に関連したことを発表します。先週金曜日は私の当番で『開発基盤チームとして課題を探したらマネジメントをしていた』という発表をしました。技術チーム以外の方もたくさん聞きに来てくれて、ありがたかったです。🙏発表の内容前回含めて、これまでの発表は全てコードが登場していました。今回のようなコードが登場しないマネジメントの話は、内容が拡散しがちで難しかったです。結局まとまりませんでした...。今回は敢えて後から読めるプレゼン資料にしました。なのでプレゼン資料としては冗長な書き方になっています。まとめるとこんな内容です。コミュニケーションの不確実性を解消することが、マネジメント（やチームビルディング）に必要なはずそのため自ら場に飛び込んで、情報の非対称性を解消していったこれからもソフトウェアを書くこと以外に課題解決の手段があればやっていくそして徐々にマネジメントにかける時間を減らし、コードを書く時間を増やしていく今思えば、話し忘れたことがポロポロと出てきます。そもそもチームメンバーは自走できる方々で、ホワイトボード整理の時も方針だけ話したら勝手に整理されていった私は方向性を決めただけチームに入りたてのときは少々オーバーリアクションを心がけ、徐々に普通に戻していく。何考えている人か分かってもらうことで、その後のコミュニケーションをスムーズにする完璧な発表などありませんね。発表の感想付箋紙に感想を書いてくれました。 は私からのコメントです。ジョハリの窓の紹介ありがとうございます。勉強になります！ 私も『エンジニアリング組織論への招待』で初めて知りました。数年前にプロダクトオーナーの学習をした以来ですから...自分はまだマネジメントからは程遠い存在なのですが、話しかけやすいオーラを出すことや、くだらないと思うことも質問することなどは、今すぐにでも実行出来るし、目指すことだと思いました。ありがとうございました！ はい、個々が意識することが自走するチームや、個々のリーダーシップに繋がると思います共感できる良い話でした あざす！初公開の画像が見られて良かったです お粗末さまでした...早くインフラ朝会にもどって来てください 今回の件が落ち着いたらインフラ朝会にもどりますよ。待っていてくださいね！必要な情報とそうでもない情報の整理はものすごい HP/MP を消費しそう そうですね...マネジメントの成果はすぐには結果に現れないかも？どの位の頻度で振り返るべきなのか？ イテレーションごとの振り返りで、チームを観察すれば良いです。マネジメントの成果かどうかは重要ではないと思います◯◯を支える技術 次回はコードの話をしよう...知識科学やり直さなきゃ・・・ 私は今回で終了ですwチームの問題点を発見して、それを解決する手段を選ばないスタンスがすごい もう必死ですよ（笑）「内心ではなく行動に注目する」は、認知行動療法などでも使われていますね（最近のトレンド？） へぇ〜なかなかボリュームある資料でしたが、作るのにどれくらいかかったのか気になります 先週土曜日の夜に草稿を作り「これでいけそう」という感触を得て、今週は平日の夜２日くらいで整理をしました。話す内容については一ヶ月くらい前から頭の中で考えたり、『エンジニアリング組織論への招待』を全部読んだりしてました最近疲弊してそうで心配でしたが、今日の発表で色々アウトプットしてもらって安心しました 気にかけて頂いてありがとうございます。これからも安心安全のマスタカをお届けして参りますうなずきすぎて首もげる ありがとうございます。参考になったことが各チームに還元されるとうれしいですマスタカさん自体はマネジメントよりコード書く方が好きなんでしょうか？ そうですね。引き篭もってコードを書きたいですますたかさんのおかげでチームがちゃんと回りはじめた気がします そう言って頂けるとうれしいです。今がスタート地点だと捉え、精進してまいります増田さんが参加されてから何かがスムーズになった実感があります（情報や知識だけでなく） うれしいですね。マネジメントは空気のような存在が良いと考えていますマネジメントってどうやるか？のテクニックの面もあるけど、誰がやるか？の面も大きい気がしてます そうですね。例えば入ったばかりの職場だと、信頼関係を築くことから始まると思います。今回は同じ会社ということと、過去に一緒に働いたメンバーがいたことに助けられましたEC Booster のこれからに期待しています！ 💪「場に飛び込む」「正しく伝わったと思わない」肝に銘じます！ よろしくお願いします！「エンジニアが発見した課題の解決フロー」読みたいです Slack で書いたとおり、割と普通のフローです。発表で話したエンジニア以外の方からの依頼と整合性を合わせてこうしました。まだ始めて間もなく 1 イテレーションも回してない状態ですがね... Issue を作ると EC Booster waffle.io の Planning カラムに入る 次の開発ミーティングで Planning カラムを空にする スプリントでは Sprint Backlog に集中するfeedforce だとマネジメントオンリーじゃなくて、開発+マネジメントが最強という話を昨日クリストフとした 最強かは分かりませんが、コードも分かったほうが捗ると思います仕事でもプライベートでも、コミュニティ内でオープンな発信をする人が多いと、円滑に物事が進みやすいなと考えられました。その逆もまた然りだったので...。かつ、人に伝えるときは具体的にするというのも大切かと思いました 他人は自分でないので、分かりやすく具体的なコミュニケーションが大事ですね え、誰？（困惑）最後にエンジニアリング組織論への招待 ~不確実性に向き合う思考と組織のリファクタリング作者: 広木大地出版社/メーカー: 技術評論社発売日: 2018/02/22メディア: 単行本（ソフトカバー）この商品を含むブログ (2件) を見る良かったぞ。「エンジニア組織論」ではないことに注目。プロダクトオーナーやエンジニア以外の職種の方にも是非読んでもらいたいです。","link":"https://developer.feedforce.jp/entry/2018/05/21/150000","isoDate":"2018-05-21T06:00:00.000Z","dateMiliSeconds":1526882400000,"authorName":"masutaka"},{"title":"github-nippou という gem を golang で書き直したという発表をした","contentSnippet":"こんにちは。増田（id:masutaka26）です。社内勉強会の順番が来ると、２ヶ月前くらいからソワソワしてきます。そんなわけで今回は『日報を golang で支える技術』というお題で発表しました。発表の内容以下、スライドからの抜粋です。背景など以前の社内勉強会で github-nippou という gem を紹介したひとつの ruby スクリプトからそこそこ作り込み、毎日便利に使っている先日も同僚の @ryz310 から pull request をもらって、さらに便利になったからの、golang への書き換えをした。その場でライブリリースモチベーション以前 hub コマンドが ruby から golang に移行したのを見て、一度やってみたかったrubygems の CLI を Dockerize してポータビリティを高めるのは何かが違うという気持ち@ryz310 からもらった元気当たり前だけど、全て代わりの方法を調べて実装しなければいけなかったoctokit → go-github, thor → cobra など。Assets の取り扱いも変わる良かったこと１バイナリになったのでインストールやアップデートが容易になったパフォーマンスも予想外に上がった（当社比約２倍）以前調べた時は GitHub への API アクセスがボトルネックだったので、そこまで変わらないと思っていた結果的にいろんなライブラリを使えて、良い素振りになった困ったこととにかく関数が長くなりがちgetXXX() 多くなりすぎファイル分割の意味書けば書くほど golang っぽい書き方が分からなくなるOOP ではないことへの戸惑いruby が柔軟すぎて移植は難しかった。オススメはしない疑問などclass設計で便利だった、private method の代わり設計し直すべきかclassを 使わなかった頃の JS の知見を知りたいビジネスロジックのパッケージ名はどうすれば今回は lib にした感想今後、rubygems で CLI ツールを作ることはないと思う。継続利用を考えると勧めづらいgolang は単一ファイルでの実装と実行に一番ハードルが低い気がしているもっと楽な言語あったら教えて今後の予定golang っぽい書き方にするもっとテストを書くgolang on Lambda や API サーバも学習する『スターティングGo言語』を読み切る結果↓https://github.com/masutaka/github-nippou発表の感想付箋紙に感想を書いてくれました。 は私からのコメントです。クラス設計周りの話は自分も悩んでいます ライブラリとか読んで学習します！GraphQL 対応の PR 出すぞ お待ちしております！Go の GraphQL のクライアント側はまだなさそう github.com/graphql-go/graphql を見つけました。API リクエストを 1 回に出来るのかな？CLI は ruby \u003c golang わかる。mruby も良いかも mruby はエコシステムが大変そうで...Makefile 参考にします あざす！Makefile 全く分からない... 勉強しないと！！ 基本だったら１日くらいで分かりますよ。make はビルドを必要な時だけに抑えられるので良いです流石ますたかさん とても面白く熱量ある発表でした ありがとうございます。熱量は大事にしてます神回ですね もっと技術レベル上げていきます！刺激を受けるいい話だった 刺激を与えるのがエンジニアとして使命のひとつだと思っていますスピード up は nice 発見 ですねやっぱりはやくなるものなんだなー   速いだけでテンションが上がりますgolang 熱の高まり・・・！！ やりましょう！go モチベーションの高さの理由が分かりました！！ もう必死ですよずっと Go 書いてたのはこれだったのかー（棒） そうなんですよー（棒）Go 書きたい 今書きましょう！ゴー書いてく！！   ｱ､ﾊｲざんねん！！わたし（@ryz310）の PR はここでおわってしまった！！ またお待ちしております！（笑）バイナリ配布うれしい！ ユーザの皆様のことを第一に考えておりますCLI は golang Web やる気にはなら… 配布を考えるとそうですねー。今は GitHub でリリースしておけば、Homebrew や zplug など配布手段はいろいろありますしディストリビューション大変だなー gox で簡単に並列ビルドできるので、それほど大変ではなかったですね知見 ライブデプロイ is つらい もうハラハラドキドキですよライブデプロイメント やはり初回の CI は絶対失敗しますね...（社内 Slack の）#golang を今後ともよろしくお願いします こちらこそ！最後にとにかく設計が目下の悩みです。良い情報があれば教えてください！","link":"https://developer.feedforce.jp/entry/2017/10/16/150000","isoDate":"2017-10-16T06:00:00.000Z","dateMiliSeconds":1508133600000,"authorName":"masutaka"}]},"__N_SSG":true},"page":"/members/[name]","query":{"name":"masutaka"},"buildId":"7g6Da-ZsrBgB1PGxBoYG0","assetPrefix":"/team-blog-hub","nextExport":false,"isFallback":false,"gsp":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"charSet":"utf-8"}],["link",{"rel":"icon shortcut","type":"image/png","href":"https://feedforce.github.io/team-blog-hub/logo.png"}],["link",{"rel":"stylesheet","href":"https://fonts.googleapis.com/css2?family=Inter:wght@400;700\u0026display=swap"}],["title",{"children":"masutaka | Feedforce Engineers' Blogs"}],["meta",{"property":"og:title","content":"masutaka"}],["meta",{"property":"og:url","content":"https://feedforce.github.io/team-blog-hub/members/masutaka"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"property":"og:site","content":"Feedforce Engineers' Blogs"}],["meta",{"property":"og:image","content":"https://feedforce.github.io/team-blog-hub/og.png"}],["link",{"rel":"canonical","href":"https://feedforce.github.io/team-blog-hub/members/masutaka"}]]}</script><script nomodule="" src="/team-blog-hub/_next/static/chunks/polyfills-fa276ba060a4a8ac7eef.js"></script><script src="/team-blog-hub/_next/static/chunks/main-8a83f0fd99327c4684a8.js" async=""></script><script src="/team-blog-hub/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/team-blog-hub/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" async=""></script><script src="/team-blog-hub/_next/static/chunks/commons.82441a6bfdc77aa8dc79.js" async=""></script><script src="/team-blog-hub/_next/static/chunks/pages/_app-db173d743a8bd3a15b64.js" async=""></script><script src="/team-blog-hub/_next/static/chunks/588505f8033a39c9ef82bc46b1145ac9fd1db500.28d75d70b20e6708c167.js" async=""></script><script src="/team-blog-hub/_next/static/chunks/pages/members/%5Bname%5D-86638f6fce8375479415.js" async=""></script><script src="/team-blog-hub/_next/static/7g6Da-ZsrBgB1PGxBoYG0/_buildManifest.js" async=""></script><script src="/team-blog-hub/_next/static/7g6Da-ZsrBgB1PGxBoYG0/_ssgManifest.js" async=""></script></body></html>